version: 2
models:

- name: p2p_peers_cl_fork_daily
  description: Aggregated daily counts of peers by current and next forks, derived from peer visit data.
  columns:
  - name: date
    description: The day of the peer visit, truncated to day precision.
    data_type: DateTime
    tests:
    - not_null
  - name: label
    description: Label indicating whether the count is for 'Current Fork' or 'Next Fork'.
    data_type: String
  - name: fork
    description: The fork name associated with the peer visit.
    data_type: String
  - name: cnt
    description: Count of peers for the given date, label, and fork.
    data_type: UInt64
  config:
    access: public
    materialized: incremental
    tags:
    - p2p
    - fork
    - daily
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: p2p_peers_clients_daily
  description: Daily aggregated count of unique peers per client, with date normalization.
  columns:
  - name: date
    description: The date representing the day of the peer activity, truncated to day level.
    data_type: DateTime64(0, 'UTC')
    tests:
    - not_null
  - name: client
    description: Client version or identifier, with 'Unknown' for missing values.
    data_type: String
    tests:
    - not_null
  - name: value
    description: Count of unique peers for the given date and client.
    data_type: UInt64
    tests:
    - not_null
  config:
    access: public
    materialized: table
    tags:
    - aggregation
    - daily
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: p2p_peers_geo_daily
  description: Daily aggregated data of P2P peers with geographic info, including counts and country.
  columns:
  - name: peer_id
    description: Unique identifier for each peer.
    data_type: String
    tests:
    - not_null
    - unique
  - name: date
    description: Date of the peer activity in UTC.
    data_type: DateTime
    tests:
    - not_null
  - name: country
    description: Country code or name associated with the peer's IP.
    data_type: String
  - name: cnt
    description: Count of peer occurrences on the given date and country.
    data_type: UInt64
    tests:
    - not_null
  config:
    access: public
    materialized: table
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: p2p_peers_geo_hourly
  description: Aggregated geographical data of peers per hour, including location, country, and visit count.
  columns:
  - name: date
    description: Hourly timestamp of the data aggregation, truncated to hour.
    data_type: DateTime64(0, 'UTC')
    tests:
    - not_null
  - name: lat
    description: Latitude extracted from IP geolocation, in decimal degrees.
    data_type: String
  - name: long
    description: Longitude extracted from IP geolocation, in decimal degrees.
    data_type: String
  - name: country
    description: Country name; defaults to 'Unknown' if missing.
    data_type: String
  - name: peer_id
    description: Unique identifier of the peer.
    data_type: String
    tests:
    - not_null
    - unique
  - name: ip
    description: IP address of the peer.
    data_type: String
  - name: cnt
    description: Count of visits for the peer in the given hour.
    data_type: UInt64
  config:
    access: public
    materialized: incremental
    tags:
    - p2p
    - geo
    - hourly
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: p2p_peers_geo_latest
  description: A view aggregating the latest geographical information of peers, including latitude, longitude, and country, based on IP data and peer activity.
  columns:
  - name: peer_id
    description: Unique identifier for each peer.
    data_type: String
    tests:
    - not_null
    - unique
  - name: date
    description: The day of the peer activity, in UTC.
    data_type: DateTime
    tests:
    - not_null
  - name: ip
    description: IP address associated with the peer.
    data_type: String
  - name: lat
    description: Latitude coordinate of the peer's IP location.
    data_type: String
  - name: long
    description: Longitude coordinate of the peer's IP location.
    data_type: String
  - name: country
    description: Country name derived from IP geolocation; 'Unknown' if not available.
    data_type: String
  config:
    access: public
    materialized: view
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: p2p_peers_geo_topology_latest
  description: A model representing the latest peer-to-peer network topology with geographical and connection details, including peer and neighbor info, timestamps, and counts.
  columns:
  - name: date
    description: The date of the crawl, truncated to day.
    data_type: DateTime64(0, 'UTC')
    tests:
    - not_null
  - name: peer_ip
    description: IP address of the peer.
    data_type: String
    tests:
    - not_null
  - name: peer_discovery_id_prefix
    description: Discovery ID prefix of the peer.
    data_type: UInt64
    tests:
    - not_null
  - name: peer_cl_fork_name
    description: Fork name of the peer client.
    data_type: String
  - name: peer_cl_next_fork_name
    description: Next fork name of the peer client.
    data_type: String
  - name: peer_client
    description: Client software of the peer.
    data_type: String
  - name: peer_hostname
    description: Hostname associated with the peer's IP.
    data_type: String
  - name: peer_city
    description: City location of the peer.
    data_type: String
  - name: peer_country
    description: Country location of the peer.
    data_type: String
  - name: peer_org
    description: Organization associated with the peer's IP.
    data_type: String
  - name: peer_loc
    description: Geographical coordinates of the peer.
    data_type: String
  - name: neighbor_ip
    description: IP address of the neighbor peer.
    data_type: String
  - name: neighbor_discovery_id_prefix
    description: Discovery ID prefix of the neighbor.
    data_type: UInt64
  - name: neighbor_cl_fork_name
    description: Fork name of the neighbor client.
    data_type: String
  - name: neighbor_cl_next_fork_name
    description: Next fork name of the neighbor client.
    data_type: String
  - name: neighbor_client
    description: Client software of the neighbor.
    data_type: String
  - name: neighbor_city
    description: City location of the neighbor.
    data_type: String
  - name: neighbor_country
    description: Country location of the neighbor.
    data_type: String
  - name: neighbor_org
    description: Organization associated with the neighbor's IP.
    data_type: String
  - name: neighbor_loc
    description: Geographical coordinates of the neighbor.
    data_type: String
  - name: cnt
    description: Count of edges between peer and neighbor for the given day.
    data_type: UInt64
    tests:
    - not_null
  config:
    access: public
    materialized: table
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: api_p2p_discv5_clients_daily
  description: Daily metrics for P2P Discv5 clients, including date, metric, label, and value.
  columns:
  - name: date
    description: The date of the metrics in YYYY-MM-DD format.
    data_type: DateTime
  - name: metric
    description: The name of the metric being recorded.
    data_type: String
  - name: label
    description: The label associated with the metric, e.g., client version or network.
    data_type: String
  - name: value
    description: The numeric value of the metric.
    data_type: Float64
  config:
    access: public
    tags:
    - production
    - p2p
    - discv5
    - clients
    materialized: view
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: api_p2p_discv5_current_fork_daily
  description: Daily count of current forks in the Discv5 network, filtered by label 'Current Fork'.
  columns:
  - name: date
    description: Date of the record in YYYY-MM-DD format.
    data_type: DateTime
  - name: fork
    description: Identifier of the fork; string representing fork version or hash.
    data_type: String
  - name: cnt
    description: Count of occurrences for the specific fork on the given date.
    data_type: UInt64
  config:
    access: public
    materialized: view
    tags:
    - production
    - p2p
    - discv4
    - forks
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: api_p2p_discv5_geo_latest
  description: A table containing the latest geolocation data for P2P peers based on Discv5, including latitude, longitude, country, and count metrics.
  columns:
  - name: date
    description: Date of the data record, representing the day of data aggregation.
    data_type: DateTime64(0, 'UTC')
    tests:
    - not_null
  - name: lat
    description: Latitude coordinate of the peer's geolocation.
    data_type: Float64
  - name: long
    description: Longitude coordinate of the peer's geolocation.
    data_type: Float64
  - name: country
    description: Country code or name where the peer is located.
    data_type: String
  - name: cnt
    description: Count of peers in the specified geolocation for the given date.
    data_type: UInt64
  config:
    access: public
    materialized: view
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: api_p2p_discv5_next_fork_daily
  description: Daily count of the next fork in the Discv5 P2P network, filtered by label 'Next Fork' and ordered by date and fork.
  columns:
  - name: date
    description: The date of the record, in YYYY-MM-DD format.
    data_type: DateTime
  - name: fork
    description: Identifier of the fork.
    data_type: String
  - name: cnt
    description: Count of occurrences for the specific fork on the given date.
    data_type: UInt64
  config:
    access: public
    materialized: view
    tags:
    - production
    - p2p
    - discv4
    - forks
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: api_p2p_discv5_topology_latest
  description: View containing the latest topology data from the Discv5 P2P network crawl, including peer and neighbor details, geographic info, and connection counts.
  columns:
  - name: date
    description: Date of the topology snapshot.
    data_type: DateTime
  - name: peer_ip
    description: IP address of the peer.
    data_type: String
  - name: peer_discovery_id_prefix
    description: Unique identifier prefix for the peer discovery ID.
    data_type: UInt64
  - name: peer_cl_fork_name
    description: Client fork name of the peer.
    data_type: String
  - name: peer_cl_next_fork_name
    description: Next client fork name of the peer.
    data_type: String
  - name: peer_client
    description: Client software name of the peer.
    data_type: String
  - name: peer_hostname
    description: Hostname of the peer.
    data_type: String
  - name: peer_city
    description: City location of the peer.
    data_type: String
  - name: peer_country
    description: Country of the peer.
    data_type: String
  - name: peer_org
    description: Organization associated with the peer.
    data_type: String
  - name: peer_lat
    description: Latitude coordinate of the peer's location.
    data_type: String
  - name: peer_lon
    description: Longitude coordinate of the peer's location.
    data_type: String
  - name: neighbor_ip
    description: IP address of the neighbor peer.
    data_type: String
  - name: neighbor_discovery_id_prefix
    description: Unique identifier prefix for the neighbor discovery ID.
    data_type: UInt64
  - name: neighbor_cl_fork_name
    description: Client fork name of the neighbor.
    data_type: String
  - name: neighbor_cl_next_fork_name
    description: Next client fork name of the neighbor.
    data_type: String
  - name: neighbor_client
    description: Client software name of the neighbor.
    data_type: String
  - name: neighbor_city
    description: City location of the neighbor.
    data_type: String
  - name: neighbor_country
    description: Country of the neighbor.
    data_type: String
  - name: neighbor_org
    description: Organization associated with the neighbor.
    data_type: String
  - name: neighbor_lat
    description: Latitude coordinate of the neighbor's location.
    data_type: String
  - name: neighbor_lon
    description: Longitude coordinate of the neighbor's location.
    data_type: String
  - name: cnt
    description: Count of connections or occurrences.
    data_type: UInt64
  config:
    access: public
    tags:
    - production
    - p2p
    - discv5
    materialized: view
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: fct_p2p_discv5_forks_daily
  description: Daily count of Discv5 forks identified, aggregated by date, fork, and label.
  columns:
  - name: date
    description: Date of the record in YYYY-MM-DD format.
    data_type: Date
  - name: label
    description: Label categorizing the fork type or status.
    data_type: String
  - name: fork
    description: Identifier for the specific fork.
    data_type: String
  - name: cnt
    description: Count of forks observed on the given date.
    data_type: UInt64
  config:
    access: public
    tags:
    - analytics
    - discv5
    materialized: table
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: fct_p2p_discv5_geo_daily
  description: Daily aggregated data capturing peer-to-peer network activity with geographic information, including date, country, and count metrics.
  columns:
  - name: date
    description: Date of the aggregated data in YYYY-MM-DD format.
    data_type: Date
    tests:
    - not_null
  - name: country
    description: Country code where the activity was observed.
    data_type: String
    tests:
    - not_null
  - name: cnt
    description: Count of network activity occurrences for the given date and country.
    data_type: UInt64
  config:
    access: public
    tags:
    - aggregate
    - daily
    materialized: table
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: api_p2p_clients_latest
  description: A view aggregating the latest P2P client counts and percentage changes for Discv4 and Discv5 metrics based on daily client data.
  columns:
  - name: discv4_count
    description: Total number of Discv4 clients for the latest date.
    data_type: UInt64
  - name: change_discv4_pct
    description: Percentage change in Discv4 clients compared to 7 days prior, rounded to 1 decimal.
    data_type: Float64
  - name: discv5_count
    description: Total number of Discv5 clients for the latest date.
    data_type: UInt64
  - name: change_discv5_pct
    description: Percentage change in Discv5 clients compared to 7 days prior, rounded to 1 decimal.
    data_type: Float64
  config:
    materialized: view
    access: public
    tags:
    - production
    - p2p
    - clients
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: api_p2p_discv4_clients_daily
  description: Daily metrics data for P2P Discv4 clients, including date, metric, label, and value.
  columns:
  - name: date
    description: Date of the metrics record (YYYY-MM-DD).
    data_type: DateTime
  - name: metric
    description: Name of the metric being recorded.
    data_type: String
  - name: label
    description: Label associated with the metric, e.g., client version or network.
    data_type: String
  - name: value
    description: Numeric value of the metric.
    data_type: Float64
  config:
    access: public
    materialized: view
    tags:
    - production
    - p2p
    - discv4
    - clients
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: api_p2p_discv4_clients_latest
  description: A view aggregating the latest P2P Discv4 client metrics, including labels and values, filtered for the most recent date.
  columns:
  - name: label
    description: Client label or identifier.
    data_type: String
  - name: metric
    description: Metric name associated with the client.
    data_type: String
  - name: value
    description: Numeric value of the metric for the client.
    data_type: Float64
  config:
    access: public
    materialized: view
    tags:
    - production
    - p2p
    - discv4
    - clients
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: api_p2p_discv5_clients_latest
  description: A view summarizing the latest P2P Discv5 client metrics, including labels and values, filtered to the most recent date.
  columns:
  - name: label
    description: Client label or identifier.
    data_type: String
  - name: metric
    description: Metric name associated with the client.
    data_type: String
  - name: value
    description: Numeric value of the metric.
    data_type: Float64
  config:
    access: public
    materialized: view
    tags:
    - production
    - p2p
    - discv5
    - clients
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: api_p2p_topology_latest
  description: View containing the latest P2P topology data with peer and neighbor details, filtered for valid latitude entries.
  columns:
  - name: protocol
    description: Protocol used in the P2P connection.
    data_type: String
  - name: date
    description: Date of the topology snapshot.
    data_type: DateTime
  - name: peer_discovery_id_prefix
    description: Unique prefix identifying the peer discovery.
    data_type: UInt64
  - name: peer_client
    description: Client software used by the peer.
    data_type: String
  - name: peer_city
    description: City where the peer is located.
    data_type: String
  - name: peer_country
    description: Country where the peer is located.
    data_type: String
  - name: peer_org
    description: Organization associated with the peer.
    data_type: String
  - name: peer_lat
    description: Latitude coordinate of the peer's location.
    data_type: String
  - name: peer_lon
    description: Longitude coordinate of the peer's location.
    data_type: String
  - name: neighbor_discovery_id_prefix
    description: Unique prefix identifying the neighbor discovery.
    data_type: UInt64
  - name: neighbor_client
    description: Client software used by the neighbor.
    data_type: String
  - name: neighbor_city
    description: City where the neighbor is located.
    data_type: String
  - name: neighbor_country
    description: Country where the neighbor is located.
    data_type: String
  - name: neighbor_org
    description: Organization associated with the neighbor.
    data_type: String
  - name: neighbor_lat
    description: Latitude coordinate of the neighbor's location.
    data_type: String
  - name: neighbor_lon
    description: Longitude coordinate of the neighbor's location.
    data_type: String
  - name: cnt
    description: Count of occurrences or connections.
    data_type: UInt64
  config:
    materialized: view
    access: public
    tags:
    - production
    - p2p
    - topology
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: api_p2p_visits_latest
  description: View aggregating latest P2P visit data, including counts and percentage success metrics for Discv4 and Discv5 crawls.
  columns:
  - name: discv4_total_visits
    description: Total number of visits recorded in the latest Discv4 crawl.
    data_type: UInt64
  - name: discv4_pct_successful
    description: Percentage of successful visits in the latest Discv4 crawl, rounded to one decimal.
    data_type: Float64
  - name: discv4_crawls
    description: Number of crawls in the latest Discv4 dataset.
    data_type: UInt64
  - name: change_discv4_crawls_pct
    description: Percentage change in crawls compared to the previous 7 days for Discv4.
    data_type: Float64
  - name: discv5_total_visits
    description: Total number of visits recorded in the latest Discv5 crawl.
    data_type: UInt64
  - name: discv5_pct_successful
    description: Percentage of successful visits in the latest Discv5 crawl, rounded to one decimal.
    data_type: Float64
  - name: discv5_crawls
    description: Number of crawls in the latest Discv5 dataset.
    data_type: UInt64
  - name: change_discv5_crawls_pct
    description: Percentage change in crawls compared to the previous 7 days for Discv5.
    data_type: Float64
  config:
    access: public
    materialized: view
    tags:
    - production
    - p2p
    - discv4
    - discv5
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: fct_p2p_topology_latest
  description: Aggregated topology data combining DiscV4 and DiscV5 protocols, including peer and neighbor details with geographic coordinates.
  columns:
  - name: protocol
    description: Protocol identifier indicating the topology source ('DiscV4' or 'DiscV5').
    data_type: String
  - name: date
    description: Date of the topology record.
    data_type: DateTime64(0, 'UTC')
  - name: peer_ip
    description: IP address of the peer.
    data_type: String
  - name: peer_discovery_id_prefix
    description: Numeric prefix used for peer discovery identification.
    data_type: UInt64
  - name: peer_client
    description: Client software used by the peer.
    data_type: String
  - name: peer_hostname
    description: Hostname of the peer.
    data_type: String
  - name: peer_city
    description: City where the peer is located.
    data_type: String
  - name: peer_country
    description: Country where the peer is located.
    data_type: String
  - name: peer_org
    description: Organization associated with the peer.
    data_type: String
  - name: peer_lat
    description: Latitude coordinate of the peer's location.
    data_type: String
  - name: peer_lon
    description: Longitude coordinate of the peer's location.
    data_type: String
  - name: neighbor_ip
    description: IP address of the neighbor peer.
    data_type: String
  - name: neighbor_discovery_id_prefix
    description: Numeric prefix used for neighbor discovery identification.
    data_type: UInt64
  - name: neighbor_client
    description: Client software used by the neighbor.
    data_type: String
  - name: neighbor_city
    description: City where the neighbor is located.
    data_type: String
  - name: neighbor_country
    description: Country where the neighbor is located.
    data_type: String
  - name: neighbor_org
    description: Organization associated with the neighbor.
    data_type: String
  - name: neighbor_lat
    description: Latitude coordinate of the neighbor's location.
    data_type: String
  - name: neighbor_lon
    description: Longitude coordinate of the neighbor's location.
    data_type: String
  - name: cnt
    description: Count of occurrences or connections.
    data_type: UInt64
  config:
    access: public
    tags:
    - production
    - p2p
    - topology
    materialized: view
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
