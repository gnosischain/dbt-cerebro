version: 2
models:

- name: p2p_peers_info
  description: Aggregated information about peers from nebula_discv5 visits, including fork details and properties.
  columns:
  - name: visit_ended_at
    description: Timestamp when the visit ended (UTC).
    data_type: DateTime64(0, 'UTC')
    tests:
    - not_null
  - name: peer_id
    description: Unique identifier for the peer.
    data_type: String
    tests:
    - not_null
    - unique
  - name: agent_version
    description: Version string of the peer's agent software.
    data_type: String
  - name: fork_digest
    description: String representation of the peer's fork digest.
    data_type: String
  - name: cl_fork_name
    description: Name of the fork corresponding to the fork digest.
    data_type: String
  - name: cl_next_fork_name
    description: Name of the next fork, either from peer properties or fallback.
    data_type: String
  - name: peer_properties
    description: JSON object containing various peer properties including fork info.
    data_type: JSON
  - name: crawl_error
    description: Error message if the crawl encountered issues.
    data_type: LowCardinality(Nullable(String))
  - name: dial_errors
    description: Array of dial error messages encountered during peer connection attempts.
    data_type: Array(LowCardinality(String))
  config:
    access: public
    materialized: view
    tags:
    - p2p
    - peers
    - information
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: p2p_discv4_peers_info
  description: Aggregated peer information derived from the discv4 crawl, including version, platform, runtime, and other metadata.
  columns:
  - name: visit_ended_at
    description: Timestamp when the peer visit ended.
    data_type: DateTime64(0, 'UTC')
    tests:
    - not_null
  - name: peer_id
    description: Unique identifier for the peer.
    data_type: String
    tests:
    - not_null
    - unique
  - name: agent_version
    description: Version string of the peer's agent software.
    data_type: String
  - name: peer_properties
    description: JSON object containing peer properties, including network ID.
    data_type: JSON
  - name: crawl_error
    description: Error message if the crawl encountered issues with this peer.
    data_type: LowCardinality(Nullable(String))
  - name: dial_errors
    description: Array of dial error messages encountered during connection attempts.
    data_type: Array(LowCardinality(String))
  - name: client
    description: Client type or platform extracted from the version string.
    data_type: String
  - name: variant
    description: Variant information parsed from the version string.
    data_type: String
  - name: version
    description: Peer software version, with build and channel suffixes removed.
    data_type: String
  - name: channel
    description: Release channel derived from version pre-build info, if available.
    data_type: String
  - name: build
    description: Build metadata or last dash-segment of the version string.
    data_type: String
  - name: platform
    description: Platform identifier extracted from version string.
    data_type: String
  - name: runtime
    description: Runtime environment extracted from version string.
    data_type: String
  config:
    access: public
    materialized: incremental
    tags:
    - p2p
    - discv4
    - peer-info
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: p2p_discv4_peers_info2
  description: A model representing peer visit information from the Discv4 network crawl, including timestamps, peer identifiers, agent versions, properties, and error details.
  columns:
  - name: visit_ended_at
    description: Timestamp when the peer visit ended.
    data_type: DateTime64(0, 'UTC')
    tests:
    - not_null
  - name: peer_id
    description: Unique identifier for the peer.
    data_type: String
    tests:
    - not_null
    - unique
  - name: agent_version
    description: Version string of the peer's agent software.
    data_type: String
  - name: peer_properties
    description: JSON object containing properties of the peer.
    data_type: JSON
  - name: crawl_error
    description: Error message encountered during crawling, if any.
    data_type: LowCardinality(Nullable(String))
  - name: dial_errors
    description: List of dial errors encountered during the visit.
    data_type: Array(LowCardinality(String))
  config:
    access: public
    materialized: incremental
    tags:
    - p2p
    - discv4
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: p2p_discv5_peers_info
  description: Aggregated peer information from Discv5 network crawl data, including peer properties, protocol versions, fork details, and version parsing.
  columns:
  - name: visit_ended_at
    description: Timestamp when the peer visit ended.
    data_type: DateTime64(0, 'UTC')
    tests:
    - not_null
  - name: peer_id
    description: Unique identifier for the peer.
    data_type: String
    tests:
    - not_null
    - unique
  - name: fork_digest
    description: Fork digest as a string, representing the peer's fork.
    data_type: String
    tests:
    - not_null
  - name: cl_fork_name
    description: Human-readable name of the fork.
    data_type: String
  - name: cl_next_fork_name
    description: Human-readable name of the next fork.
    data_type: String
  - name: peer_properties
    description: JSON object containing peer properties including fork digests and versions.
    data_type: JSON
  - name: crawl_error
    description: Error message if the crawl encountered issues with this peer.
    data_type: LowCardinality(String)
  - name: dial_errors
    description: List of dial errors encountered during peer connection attempts.
    data_type: Array(LowCardinality(String))
  - name: client
    description: Client identifier extracted from agent version.
    data_type: String
  - name: variant
    description: Variant extracted from agent version.
    data_type: String
  - name: version
    description: Parsed version string from peer's version blob.
    data_type: String
  - name: channel
    description: Channel information parsed from version blob.
    data_type: String
  - name: build
    description: Build metadata extracted from version blob.
    data_type: String
  - name: platform
    description: Platform extracted from agent version slash parts.
    data_type: String
  - name: runtime
    description: Runtime environment extracted from agent version slash parts.
    data_type: String
  config:
    access: public
    materialized: incremental
    tags:
    - discv5
    - peer-info
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: int_p2p_discv4_peers
  description: This model consolidates peer visit data from the Discv4 network crawl, including metadata such as agent version, connection addresses, peer properties, and geographic information from external IP info sources.
  columns:
  - name: visit_ended_at
    description: Timestamp when the peer visit ended.
    data_type: DateTime64(0, 'UTC')
  - name: peer_id
    description: Unique identifier for the peer.
    data_type: String
  - name: agent_version
    description: Version string of the peer's agent software.
    data_type: String
  - name: connect_maddr
    description: Multiaddress used for connection, may be null if unavailable.
    data_type: String
  - name: peer_properties
    description: JSON object containing peer-specific properties.
    data_type: JSON
  - name: crawl_error
    description: Error message encountered during crawl, if any.
    data_type: String
  - name: dial_errors
    description: List of dial errors encountered during connection attempts.
    data_type: String
  - name: client
    description: Client type extracted from peer properties.
    data_type: String
  - name: variant
    description: Variant identifier derived from version string.
    data_type: String
  - name: version
    description: Peer software version, parsed from version string.
    data_type: String
  - name: channel
    description: Channel information parsed from version string.
    data_type: String
  - name: build
    description: Build identifier parsed from version string.
    data_type: String
  - name: platform
    description: Platform name extracted from agent version.
    data_type: String
  - name: runtime
    description: Runtime environment extracted from agent version.
    data_type: String
  - name: peer_hostname
    description: Hostname associated with the peer's IP address.
    data_type: String
  - name: peer_city
    description: City location from IP info.
    data_type: String
  - name: peer_country
    description: Country location from IP info.
    data_type: String
  - name: peer_org
    description: Organization associated with the IP address.
    data_type: String
  - name: peer_loc
    description: Geographical location data.
    data_type: String
  - name: generic_provider
    description: External provider information for the IP address.
    data_type: String
  config:
    access: public
    tags:
    - production
    - p2p
    - discv4
    materialized: incremental
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: int_p2p_discv5_clients_daily
  description: Aggregated daily client, platform, provider, and country metrics derived from peers data, segmented by date and label.
  columns:
  - name: date
    description: The day of data aggregation, in UTC.
    data_type: DateTime64(0, 'UTC')
  - name: metric
    description: The metric category, e.g., Clients, Platform, Provider, Country.
    data_type: String
  - name: label
    description: The specific label within the metric, e.g., client name, platform, provider, country.
    data_type: String
  - name: value
    description: Count of peers corresponding to the metric and label for the given date.
    data_type: UInt64
  config:
    access: public
    tags:
    - production
    - p2p
    - discv5
    materialized: incremental
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: int_p2p_discv5_forks_daily
  description: Aggregated daily counts of peers by current and next forks, derived from peer visit data, grouped by date and fork labels.
  columns:
  - name: date
    description: The day of the peer visit, truncated to start of day.
    data_type: DateTime64(0, 'UTC')
  - name: label
    description: Label indicating whether the record is for current or next fork.
    data_type: String
  - name: fork
    description: The fork name associated with the peer visit.
    data_type: String
  - name: cnt
    description: Count of peer visits for the given date, label, and fork.
    data_type: UInt64
  config:
    access: public
    tags:
    - production
    - p2p
    - discv5
    materialized: incremental
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: int_p2p_discv5_geo_daily
  description: Aggregated daily geolocation data for P2P peers discovered via Discv5, including country, latitude, and longitude information.
  columns:
  - name: date
    description: The day of the peer activity, truncated to day granularity.
    data_type: DateTime64(0, 'UTC')
  - name: lat
    description: Latitude extracted from IP geolocation; null if unavailable.
    data_type: String
  - name: long
    description: Longitude extracted from IP geolocation; null if unavailable.
    data_type: String
  - name: country
    description: Country name derived from IP geolocation; 'Unknown' if not available.
    data_type: String
  - name: cnt
    description: Count of peer visits for the given date and location.
    data_type: UInt64
  config:
    access: public
    tags:
    - production
    - p2p
    - discv5
    materialized: table
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: int_p2p_discv5_peers
  description: Contains detailed peer information extracted from Discv5 crawl data, including version parsing, fork identification, and peer properties for analysis.
  columns:
  - name: crawl_id
    description: Unique identifier for the crawl session.
    data_type: UUID
  - name: visit_ended_at
    description: Timestamp when the peer visit ended.
    data_type: DateTime64(0, 'UTC')
  - name: peer_id
    description: Unique identifier for the peer.
    data_type: String
  - name: connect_maddr
    description: Multi-address used to connect to the peer.
    data_type: String
  - name: fork_digest
    description: Fork digest as a string, representing the fork version.
    data_type: String
  - name: next_fork_version
    description: Next fork version as a string.
    data_type: String
  - name: cl_fork_name
    description: Human-readable name of the fork based on digest.
    data_type: String
  - name: cl_next_fork_name
    description: Human-readable name of the next fork version.
    data_type: String
  - name: peer_properties
    description: JSON object containing peer properties including fork digests and versions.
    data_type: JSON
  - name: crawl_error
    description: Error message if the crawl encountered issues with this peer.
    data_type: String
  - name: dial_errors
    description: List of dial errors encountered when connecting to the peer.
    data_type: String
  - name: agent_version
    description: Agent version string reported by the peer.
    data_type: String
  - name: parts
    description: Array of parts obtained by splitting the agent version string by '/'.
    data_type: Array(String)
  - name: parts_len
    description: Number of parts in the agent version string.
    data_type: UInt64
  - name: tail
    description: Subarray of parts after the first split, used for version detection.
    data_type: Array(String)
  - name: tail_len
    description: Length of the tail array.
    data_type: UInt64
  - name: client
    description: Client identifier extracted from the agent version.
    data_type: String
  - name: ver_idx_tail
    description: Index in parts array where version token is located.
    data_type: UInt64
  - name: variant
    description: Variant token between client and version, if present.
    data_type: String
  - name: ver_blob
    description: Raw version token, may include build or channel info.
    data_type: String
  - name: platform
    description: Platform info extracted from version string.
    data_type: String
  - name: runtime
    description: Runtime info extracted from version string.
    data_type: String
  - name: pre_blob
    description: Version blob before '+' sign.
    data_type: String
  - name: plus_build
    description: Build info after '+' sign in version blob.
    data_type: String
  - name: hy_parts
    description: Array of hyphen-separated parts from version blob.
    data_type: Array(String)
  - name: version
    description: Extracted version string from hy_parts.
    data_type: String
  - name: channel
    description: Channel info from hy_parts.
    data_type: String
  - name: build
    description: Build info from hy_parts or plus_build.
    data_type: String
  - name: ip
    description: Peer IP address extracted from connect_maddr.
    data_type: String
  - name: peer_hostname
    description: Hostname associated with the peer IP.
    data_type: String
  - name: peer_city
    description: City location of the peer.
    data_type: String
  - name: peer_country
    description: Country location of the peer.
    data_type: String
  - name: peer_org
    description: Organization associated with the peer.
    data_type: String
  - name: peer_loc
    description: Geographical location of the peer.
    data_type: String
  - name: generic_provider
    description: Provider information for the peer.
    data_type: String
  config:
    access: public
    tags:
    - production
    - p2p
    - discv5
    materialized: incremental
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: int_p2p_discv5_topology_latest
  description: A model representing the latest Discv5 peer-to-peer topology data, including peer and neighbor details, geolocation info, and connection counts.
  columns:
  - name: date
    description: The date of the crawl, truncated to day.
    data_type: DateTime
  - name: peer_ip
    description: IP address of the peer.
    data_type: String
  - name: peer_discovery_id_prefix
    description: Discovery ID prefix for the peer.
    data_type: UInt64
  - name: peer_cl_fork_name
    description: Fork name of the peer client.
    data_type: String
  - name: peer_cl_next_fork_name
    description: Next fork name of the peer client.
    data_type: String
  - name: peer_client
    description: Client software name of the peer.
    data_type: String
  - name: peer_hostname
    description: Hostname of the peer IP.
    data_type: String
  - name: peer_city
    description: City location of the peer IP.
    data_type: String
  - name: peer_country
    description: Country of the peer IP.
    data_type: String
  - name: peer_org
    description: Organization associated with the peer IP.
    data_type: String
  - name: peer_loc
    description: Geographical coordinates of the peer IP.
    data_type: String
  - name: neighbor_ip
    description: IP address of the neighbor peer.
    data_type: String
  - name: neighbor_discovery_id_prefix
    description: Discovery ID prefix for the neighbor.
    data_type: UInt64
  - name: neighbor_cl_fork_name
    description: Fork name of the neighbor client.
    data_type: String
  - name: neighbor_cl_next_fork_name
    description: Next fork name of the neighbor client.
    data_type: String
  - name: neighbor_client
    description: Client software name of the neighbor.
    data_type: String
  - name: neighbor_city
    description: City location of the neighbor IP.
    data_type: String
  - name: neighbor_country
    description: Country of the neighbor IP.
    data_type: String
  - name: neighbor_org
    description: Organization associated with the neighbor IP.
    data_type: String
  - name: neighbor_loc
    description: Geographical coordinates of the neighbor IP.
    data_type: String
  - name: cnt
    description: Count of edges between peer and neighbor for the given day.
    data_type: UInt64
  config:
    access: public
    materialized: table
    tags:
    - production
    - p2p
    - discv5
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_p2p_discv4_clients_daily
  description: Daily counts and labels for peers based on visit data, including client, platform, provider, and country metrics derived from the discv4 crawl.
  columns:
  - name: peer_country
    description: Country code of the peer, e.g., 'US', 'DE'.
    data_type: String
  - name: date
    description: Date of the data aggregation in UTC.
    data_type: DateTime64(0, 'UTC')
  - name: metric
    description: Type of metric, e.g., 'Clients', 'Platform', 'Provider', 'Country'.
    data_type: String
  - name: label
    description: Label value for the metric, e.g., client name, platform, provider, country code.
    data_type: String
  - name: value
    description: Count of peers matching the label for the given date and metric.
    data_type: UInt64
  config:
    access: public
    tags:
    - production
    - p2p
    - discv4
    materialized: incremental
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: int_p2p_discv4_topology_latest
  description: A model representing the latest peer discovery topology data, including peer and neighbor information, geolocation details, and connection counts, aggregated from multiple sources and crawls.
  columns:
  - name: date
    description: The date of the crawl, truncated to day.
    data_type: DateTime
  - name: peer_ip
    description: IP address of the peer.
    data_type: String
  - name: peer_discovery_id_prefix
    description: Discovery ID prefix of the peer.
    data_type: UInt64
  - name: peer_client
    description: Client software used by the peer.
    data_type: String
  - name: peer_hostname
    description: Hostname of the peer, if available.
    data_type: String
  - name: peer_city
    description: City location of the peer.
    data_type: String
  - name: peer_country
    description: Country location of the peer.
    data_type: String
  - name: peer_org
    description: Organization associated with the peer's IP.
    data_type: String
  - name: peer_loc
    description: Geographical coordinates of the peer.
    data_type: String
  - name: neighbor_ip
    description: IP address of the neighbor.
    data_type: String
  - name: neighbor_discovery_id_prefix
    description: Discovery ID prefix of the neighbor.
    data_type: UInt64
  - name: neighbor_client
    description: Client software used by the neighbor.
    data_type: String
  - name: neighbor_city
    description: City location of the neighbor.
    data_type: String
  - name: neighbor_country
    description: Country location of the neighbor.
    data_type: String
  - name: neighbor_org
    description: Organization associated with the neighbor's IP.
    data_type: String
  - name: neighbor_loc
    description: Geographical coordinates of the neighbor.
    data_type: String
  - name: cnt
    description: Count of edges between the peer and neighbor for the given day.
    data_type: UInt64
  config:
    access: public
    materialized: table
    tags:
    - production
    - p2p
    - discv4
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: int_p2p_discv4_visits_daily
  description: Daily aggregated count of visits with total, successful, and crawl count metrics, filtered by network ID and date.
  columns:
  - name: date
    description: The day of the visit, truncated to start of day.
    data_type: DateTime64(0, 'UTC')
  - name: total_visits
    description: Total number of visits on the date.
    data_type: UInt64
  - name: successful_visits
    description: Count of successful visits where no dial errors or crawl errors are present.
    data_type: UInt64
  - name: crawls
    description: Number of distinct crawl IDs associated with the visits.
    data_type: UInt64
  config:
    access: public
    tags:
    - production
    - p2p
    - discv4
    materialized: incremental
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: int_p2p_discv5_visits_daily
  description: Daily aggregated visit data from the Discv5 network, including counts of total and successful visits, grouped by date.
  columns:
  - name: date
    description: The day for which the visit data is aggregated.
    data_type: DateTime64(0, 'UTC')
  - name: fork_digest
    description: Fork digest identifier (hex string) representing the network fork.
    data_type: String
  - name: cl_fork_name
    description: Human-readable name of the fork.
    data_type: String
  - name: total_visits
    description: Total number of visits during the day.
    data_type: UInt64
  - name: successful_visits
    description: Count of visits without dial errors or with null crawl_error.
    data_type: UInt64
  - name: crawls
    description: Number of distinct crawl IDs associated with visits.
    data_type: UInt64
  config:
    access: public
    tags:
    - production
    - p2p
    - discv5
    materialized: table
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
