version: 2
models:

- name: esg_consensus_power
  description: Provides consensus power data with client types and mean values for analysis.
  columns:
  - name: type
    description: The type of power consensus, e.g., 4, 5, 6.
    data_type: UInt64
    tests:
    - not_null
  - name: client
    description: The client name, e.g., Lighthouse, Teku, Lodestar, Nimbus, Prysm.
    data_type: String
    tests:
    - not_null
  - name: mean
    description: The mean value of power consensus in floating point units.
    data_type: Float64
    tests:
    - not_null
  config:
    access: public
    materialized: view
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: esg_country_power_consumption
  description: Aggregated power consumption data by country, combining consensus and execution power metrics along with client-specific estimates.
  columns:
  - name: date
    description: Date of the power consumption record
    data_type: DateTime
    tests:
    - not_null
  - name: country
    description: Country code or name
    data_type: String
    tests:
    - not_null
  - name: power
    description: Estimated power consumption in units consistent with source data
    data_type: Float64
  - name: mean
    description: Calculated mean power value based on client and configuration data
    data_type: Float64
  - name: client
    description: Client identifier associated with power metrics
    data_type: String
  - name: type
    description: Power type category (e.g., consensus, execution, idle)
    data_type: String
  config:
    materialized: table
    access: public
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: esg_execution_power
  description: A model representing execution power metrics categorized by type and client, with mean values.
  columns:
  - name: type
    description: The type of execution, represented as an integer.
    data_type: UInt64
    tests:
    - not_null
  - name: client
    description: The client name, such as 'Erigon' or 'Nethermind'.
    data_type: String
    tests:
    - not_null
  - name: mean
    description: The average execution power value, in floating point units.
    data_type: Float64
    tests:
    - not_null
  config:
    access: public
    materialized: view
    tags:
    - metrics
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: esg_hardware_config
  description: Hardware configuration details including type, CPU, cores/threads, architecture, RAM, storage, GPU, PSU, case, and OS.
  columns:
  - name: architecture
    description: CPU architecture type, e.g., x86/x64.
    data_type: String
    tests:
    - not_null
  - name: os
    description: Operating system installed, e.g., Ubuntu 20.04.
    data_type: String
    tests:
    - not_null
  - name: ram
    description: RAM size in GB, e.g., 16 GB, 64 GB, 256 GB.
    data_type: String
    tests:
    - not_null
  - name: storage
    description: Storage capacity, e.g., 2 TB SSD.
    data_type: String
    tests:
    - not_null
  - name: type
    description: Hardware type identifier, e.g., 4, 5, 6.
    data_type: UInt64
    tests:
    - not_null
    - unique
  - name: cpu
    description: CPU model, e.g., Intel i5-1135G7.
    data_type: String
    tests:
    - not_null
  - name: cores_threads
    description: Cores and threads, e.g., 4/8, 6/12, 32/64.
    data_type: String
    tests:
    - not_null
  - name: psu
    description: Power supply wattage, e.g., 65 Watt, 650 Watt.
    data_type: String
    tests:
    - not_null
  - name: case
    description: Case type, e.g., Integrated, Custom.
    data_type: String
    tests:
    - not_null
  - name: gpu
    description: GPU model, e.g., Onboard, AM 6970.
    data_type: String
    tests:
    - not_null
  config:
    access: public
    materialized: view
    tags:
    - hardware
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: esg_idle_electric_power
  description: Model representing average idle electric power metrics categorized by type.
  columns:
  - name: type
    description: Power type categories (e.g., 4, 5, 6)
    data_type: UInt64
    tests:
    - not_null
  - name: mean
    description: Average idle electric power in units consistent with source (e.g., kWh)
    data_type: Float64
    tests:
    - not_null
  config:
    access: public
    materialized: view
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: esg_node_distribution
  description: Provides the distribution of node types with their associated proportions.
  columns:
  - name: type
    description: Node type identifier (e.g., 4, 5, 6)
    data_type: UInt64
    tests:
    - not_null
    - unique
  - name: distribution
    description: Proportion of nodes for each type (values between 0 and 1)
    data_type: Float64
    tests:
    - not_null
  config:
    access: public
    materialized: view
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_country_power_consumption
  description: Business-facing model aggregating power consumption data by country and client, based on multiple source tables and calculations.
  columns:
  - name: date
    description: The date of the power consumption record.
    data_type: DateTime
  - name: country
    description: The country code or name associated with the record.
    data_type: String
  - name: client
    description: The client identifier, e.g., consensus or execution client.
    data_type: String
  - name: type
    description: The type of power measurement or power source.
    data_type: String
  - name: mean
    description: The average power consumption value in wei.
    data_type: UInt64
  config:
    access: public
    materialized: table
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_carbon_intensity_ensemble
  description: This model provides monthly estimates of carbon intensity with uncertainty modeling, seasonal adjustments, and confidence intervals for ESG analysis.
  columns:
  - name: month_date
    description: The first day of the month for the carbon intensity measurement.
    data_type: DateTime
  - name: country_code
    description: ISO 3 code or 'WORLD' for aggregate data.
    data_type: String
  - name: continent
    description: Continent associated with the country, e.g., Europe, Asia.
    data_type: String
  - name: carbon_intensity_mean
    description: Estimated average carbon intensity in gCO2/kWh, seasonally adjusted.
    data_type: Float64
  - name: carbon_intensity_std
    description: Standard deviation representing combined temporal and measurement uncertainty.
    data_type: Float64
  - name: ci_lower_95
    description: Lower bound of the 95% confidence interval.
    data_type: Float64
  - name: ci_upper_95
    description: Upper bound of the 95% confidence interval.
    data_type: Float64
  - name: ci_lower_90
    description: Lower bound of the 90% confidence interval.
    data_type: Float64
  - name: ci_upper_90
    description: Upper bound of the 90% confidence interval.
    data_type: Float64
  - name: coefficient_of_variation
    description: Ratio of the combined uncertainty to the mean, indicating relative variability.
    data_type: Float64
  - name: uncertainty_category
    description: 'Qualitative assessment of uncertainty: Low, Medium, or High.'
    data_type: String
  - name: base_carbon_intensity
    description: Raw base carbon intensity in gCO2/kWh before seasonal adjustment.
    data_type: Float64
  - name: temporal_std
    description: Standard deviation due to temporal variation.
    data_type: Float64
  - name: measurement_std
    description: Standard deviation due to measurement uncertainty.
    data_type: Float64
  - name: seasonal_adjustment
    description: Seasonal adjustment factor applied to the base carbon intensity.
    data_type: Float64
  - name: sources_used
    description: List of data sources contributing to the estimate.
    data_type: JSON
  - name: confidence_score
    description: Confidence score assigned to the estimate based on data quality.
    data_type: Float64
  - name: n_sources
    description: Number of data sources used.
    data_type: UInt64
  - name: calculated_at
    description: Timestamp when the estimate was calculated.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - carbon_intensity
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_dynamic_power_consumption
  description: This model calculates the dynamic power consumption and associated carbon emissions for different node categories across various regions and countries, incorporating efficiency factors, CCRI empirical data, and robust fallback mechanisms for carbon intensity data.
  columns:
  - name: nodes_lower_95
    description: Lower bound of the 95% confidence interval for estimated total nodes
    data_type: UInt64
  - name: country_code
    description: ISO 3-letter country code
    data_type: String
  - name: sub_region
    description: Sub-region within the country
    data_type: String
  - name: node_category
    description: Category of node (e.g., home_staker, professional_operator, cloud_hosted)
    data_type: String
  - name: country_name
    description: Name of the country
    data_type: String
  - name: estimated_total_nodes
    description: Estimated total number of nodes
    data_type: UInt64
  - name: nodes_upper_95
    description: Upper bound of the 95% confidence interval for estimated total nodes
    data_type: UInt64
  - name: country_code_alpha3
    description: ISO 3-letter country code (alpha-3)
    data_type: String
  - name: region
    description: Geographic region
    data_type: String
  - name: date
    description: Date of the data point
    data_type: DateTime
  - name: avg_power_watts_per_node
    description: Average power consumption per node in watts
    data_type: Float64
  - name: power_std_dev_per_node
    description: Standard deviation of power consumption per node in watts
    data_type: Float64
  - name: daily_energy_kwh_mean
    description: Estimated daily energy consumption in kilowatt-hours
    data_type: Float64
  - name: pue_factor
    description: Power Usage Effectiveness (PUE) factor
    data_type: Float64
  - name: client_efficiency
    description: Aggregate client efficiency multiplier
    data_type: Float64
  - name: diversity_bonus
    description: Resilience bonus based on client diversity
    data_type: Float64
  - name: daily_co2_kg_mean
    description: Estimated daily CO2 emissions in kilograms
    data_type: Float64
  - name: daily_co2_kg_std
    description: Standard deviation of daily CO2 emissions in kilograms
    data_type: Float64
  - name: carbon_intensity_gco2_kwh
    description: Carbon intensity in gCO2 per kWh from the lookup
    data_type: Float64
  - name: carbon_intensity_std_gco2_kwh
    description: Standard deviation of carbon intensity in gCO2 per kWh
    data_type: Float64
  - name: carbon_intensity_source
    description: Source of the carbon intensity data ('country_specific', 'world_average', 'conservative_default')
    data_type: String
  - name: ccri_base_power_watts
    description: CCRI empirical base power in watts
    data_type: Float64
  - name: power_source
    description: Data source for CCRI power measurement
    data_type: String
  - name: measurement_confidence
    description: Confidence level of CCRI empirical data
    data_type: Float64
  - name: power_reduction_vs_previous_pct
    description: Percentage reduction compared to previous estimates
    data_type: Float64
  - name: client_breakdown
    description: JSON string of client type breakdowns
    data_type: String
  - name: total_client_nodes
    description: Total number of client nodes
    data_type: UInt64
  - name: calculated_at
    description: Timestamp when the calculation was performed
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - power_consumption
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_node_classification
  description: A model classifying nodes into categories based on observed peer data, with associated confidence scores, distribution metrics, and geographic insights.
  columns:
  - name: observation_date
    description: Date of the peer observation in YYYY-MM-DD format.
    data_type: DateTime
  - name: peer_id
    description: Unique identifier for the peer node.
    data_type: String
  - name: ip_address
    description: The IP address associated with the peer.
    data_type: String
  - name: client_type
    description: Client software or type used by the peer.
    data_type: String
  - name: country_code
    description: Country code of the peer, ISO Alpha-2.
    data_type: String
  - name: generic_provider
    description: The cloud or hosting provider associated with the peer.
    data_type: String
  - name: peer_org
    description: Organization name of the peer.
    data_type: String
  - name: last_seen_that_day
    description: Timestamp of the last observation for the peer on that day.
    data_type: DateTime
  - name: node_category
    description: 'Classified category of the node: cloud_hosted, professional_operator, home_staker, or unknown.'
    data_type: String
  - name: classification_confidence
    description: Confidence score (0 to 1) indicating classification certainty.
    data_type: Float64
  - name: observed_nodes
    description: Count of distinct peers observed on the day.
    data_type: UInt64
  - name: estimated_total_nodes
    description: Estimated total number of nodes in the category after scaling.
    data_type: UInt64
  - name: nodes_lower_95
    description: Lower bound estimate (95% confidence) for total nodes.
    data_type: UInt64
  - name: nodes_upper_95
    description: Upper bound estimate (95% confidence) for total nodes.
    data_type: UInt64
  - name: sample_coverage
    description: Proportion of the network sampled, scaled between 0 and 1.
    data_type: Float64
  - name: scaling_factor
    description: Factor used to scale observed nodes to estimate total nodes.
    data_type: Float64
  - name: category_percentage
    description: Percentage share of the category within total estimated nodes for the day.
    data_type: Float64
  - name: hidden_nodes_estimated
    description: Estimated number of hidden nodes in the category.
    data_type: UInt64
  - name: hidden_nodes_percentage
    description: Percentage of hidden nodes relative to total estimated nodes.
    data_type: Float64
  - name: geographic_distribution
    description: JSON array of tuples with country codes and estimated nodes.
    data_type: String
  - name: top_countries
    description: String listing top five countries by estimated nodes, separated by commas.
    data_type: String
  - name: calculated_at
    description: Timestamp when the report was generated.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - nodes
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_node_client_distribution
  description: Business-facing model providing client distribution metrics per node category, including estimated client nodes, percentage breakdowns, and rankings, based on classification and client data sources.
  columns:
  - name: date
    description: Date of the data snapshot, in UTC.
    data_type: DateTime
  - name: node_category
    description: Category of nodes, e.g., validator type or classification label.
    data_type: String
  - name: estimated_total_nodes
    description: Estimated total number of nodes in the category.
    data_type: UInt64
  - name: nodes_lower_95
    description: Lower bound of 95% confidence interval for total nodes.
    data_type: UInt64
  - name: nodes_upper_95
    description: Upper bound of 95% confidence interval for total nodes.
    data_type: UInt64
  - name: scaling_factor
    description: Scaling factor applied during classification.
    data_type: Float64
  - name: client_type
    description: Type of client, e.g., consensus or execution client with label.
    data_type: String
  - name: observed_client_nodes
    description: Number of observed client nodes for the given type.
    data_type: UInt64
  - name: observed_client_percentage
    description: Percentage of client nodes relative to total observed in the day.
    data_type: Float64
  - name: estimated_client_nodes
    description: Estimated number of client nodes in the category.
    data_type: UInt64
  - name: client_nodes_lower_95
    description: Lower bound estimate of client nodes at 95% confidence.
    data_type: UInt64
  - name: client_nodes_upper_95
    description: Upper bound estimate of client nodes at 95% confidence.
    data_type: UInt64
  - name: client_efficiency_factor
    description: Efficiency factor for the client type relative to baseline.
    data_type: Float64
  - name: category_client_percentage
    description: Percentage of estimated client nodes within the node category.
    data_type: Float64
  - name: global_client_percentage
    description: Percentage of estimated client nodes across all categories.
    data_type: Float64
  - name: rank_in_category
    description: Rank of the client type within its node category based on estimated nodes.
    data_type: UInt64
  - name: global_rank
    description: Global rank of the client type across all categories.
    data_type: UInt64
  - name: calculated_at
    description: Timestamp when the metrics were calculated.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - nodes
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_node_geographic_distribution
  description: This model provides a detailed distribution of nodes across countries and regions, including estimated counts, confidence bounds, and rankings, for each node category and date.
  columns:
  - name: date
    description: The date of the data snapshot, in UTC.
    data_type: DateTime
  - name: node_category
    description: The category of nodes, representing different classifications.
    data_type: String
  - name: country_code
    description: The ISO alpha-2 country code.
    data_type: String
  - name: country_name
    description: The full name of the country.
    data_type: String
  - name: region
    description: The region to which the country belongs.
    data_type: String
  - name: sub_region
    description: The sub-region within the main region.
    data_type: String
  - name: country_code_alpha3
    description: The ISO alpha-3 country code.
    data_type: String
  - name: estimated_total_nodes
    description: The estimated total number of nodes in the country, as a UInt64.
    data_type: UInt64
  - name: nodes_lower_95
    description: The lower bound of the 95% confidence interval for node count.
    data_type: UInt64
  - name: nodes_upper_95
    description: The upper bound of the 95% confidence interval for node count.
    data_type: UInt64
  - name: category_percentage
    description: The percentage of total nodes within the category that are in this country.
    data_type: Float64
  - name: global_percentage
    description: The percentage of total nodes across all categories and countries for the date.
    data_type: Float64
  - name: rank_in_category
    description: The ranking of the country within its node category based on estimated nodes.
    data_type: UInt64
  - name: global_rank
    description: The ranking of the country globally based on estimated nodes.
    data_type: UInt64
  - name: calculated_at
    description: Timestamp when the data was computed.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - nodes
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_node_population_chao1
  description: Model estimating network population using Chao1 method, including successful, all, and unreachable nodes, with detailed failure analysis and derived metrics.
  columns:
  - name: observation_date
    description: Date of observation, in UTC, representing the day of data collection.
    data_type: DateTime
  - name: connection_status
    description: Connection outcome categorized as 'successful', 'failed', or 'unknown'.
    data_type: String
  - name: failure_type
    description: Specific failure reason, such as 'timeout', 'refused', 'unreachable', etc.
    data_type: String
  - name: crawl_id
    description: Unique identifier for each crawl attempt.
    data_type: String
  - name: peer_id
    description: Unique identifier for each peer node.
    data_type: String
  - name: times_observed
    description: Number of distinct crawl attempts observed for the peer on the given date.
    data_type: UInt64
  - name: s_obs_successful
    description: Count of distinct peers observed successfully on the date.
    data_type: UInt64
  - name: f1_successful
    description: Count of peers observed exactly once successfully.
    data_type: UInt64
  - name: f2_successful
    description: Count of peers observed exactly twice successfully.
    data_type: UInt64
  - name: s_obs_all
    description: Count of total peers observed (successful + failed) on the date.
    data_type: UInt64
  - name: f1_all
    description: Count of peers observed exactly once in all attempts.
    data_type: UInt64
  - name: f2_all
    description: Count of peers observed exactly twice in all attempts.
    data_type: UInt64
  - name: peers_with_only_failures
    description: Count of peers with only failed connection attempts and no success.
    data_type: UInt64
  - name: estimated_reachable_from_failures
    description: Estimated number of peers reachable based on failure analysis.
    data_type: Float64
  - name: chao1_successful_only
    description: Estimated total successful peers using Chao1 estimator.
    data_type: UInt64
  - name: chao1_all_discovered
    description: Estimated total peers discovered in all attempts via Chao1.
    data_type: UInt64
  - name: estimated_additional_reachable
    description: Additional reachable peers estimated from failure analysis.
    data_type: UInt64
  - name: enhanced_total_reachable
    description: Total estimated reachable peers combining successful and failure-based estimates.
    data_type: UInt64
  - name: estimated_network_size
    description: Overall network size estimate including unreachable nodes.
    data_type: UInt64
  - name: connection_success_rate_pct
    description: Percentage of successful connections out of total observed peers.
    data_type: Float64
  - name: network_discovery_coverage_pct
    description: Percentage of network discovered relative to total attempts.
    data_type: Float64
  - name: reachable_discovery_coverage_pct
    description: Percentage of successfully reachable nodes relative to total estimated reachable.
    data_type: Float64
  - name: hidden_successful_nodes
    description: Estimated number of successful nodes not observed directly.
    data_type: UInt64
  - name: hidden_reachable_nodes
    description: Estimated number of reachable nodes not observed directly.
    data_type: UInt64
  - name: hidden_total_nodes
    description: Estimated total nodes including unreachable, not directly observed.
    data_type: UInt64
  - name: hidden_successful_pct
    description: Percentage of hidden successful nodes relative to total estimated successful.
    data_type: Float64
  - name: hidden_total_pct
    description: Percentage of total hidden nodes relative to total network size.
    data_type: Float64
  - name: calculated_at
    description: Timestamp when the estimation was computed.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - nodes
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
