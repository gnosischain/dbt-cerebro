version: 2
models:

- name: esg_consensus_power
  description: Provides consensus power data with client types and mean values for analysis.
  columns:
  - name: type
    description: The type of power consensus, e.g., 4, 5, 6.
    data_type: UInt64
    tests:
    - not_null
  - name: client
    description: The client name, e.g., Lighthouse, Teku, Lodestar, Nimbus, Prysm.
    data_type: String
    tests:
    - not_null
  - name: mean
    description: The mean value of power consensus in floating point units.
    data_type: Float64
    tests:
    - not_null
  config:
    access: public
    materialized: view
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: esg_country_power_consumption
  description: Aggregated power consumption data by country, combining consensus and execution power metrics along with client-specific estimates.
  columns:
  - name: date
    description: Date of the power consumption record
    data_type: DateTime
    tests:
    - not_null
  - name: country
    description: Country code or name
    data_type: String
    tests:
    - not_null
  - name: power
    description: Estimated power consumption in units consistent with source data
    data_type: Float64
  - name: mean
    description: Calculated mean power value based on client and configuration data
    data_type: Float64
  - name: client
    description: Client identifier associated with power metrics
    data_type: String
  - name: type
    description: Power type category (e.g., consensus, execution, idle)
    data_type: String
  config:
    materialized: table
    access: public
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: esg_execution_power
  description: A model representing execution power metrics categorized by type and client, with mean values.
  columns:
  - name: type
    description: The type of execution, represented as an integer.
    data_type: UInt64
    tests:
    - not_null
  - name: client
    description: The client name, such as 'Erigon' or 'Nethermind'.
    data_type: String
    tests:
    - not_null
  - name: mean
    description: The average execution power value, in floating point units.
    data_type: Float64
    tests:
    - not_null
  config:
    access: public
    materialized: view
    tags:
    - metrics
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: esg_hardware_config
  description: Hardware configuration details including type, CPU, cores/threads, architecture, RAM, storage, GPU, PSU, case, and OS.
  columns:
  - name: architecture
    description: CPU architecture type, e.g., x86/x64.
    data_type: String
    tests:
    - not_null
  - name: os
    description: Operating system installed, e.g., Ubuntu 20.04.
    data_type: String
    tests:
    - not_null
  - name: ram
    description: RAM size in GB, e.g., 16 GB, 64 GB, 256 GB.
    data_type: String
    tests:
    - not_null
  - name: storage
    description: Storage capacity, e.g., 2 TB SSD.
    data_type: String
    tests:
    - not_null
  - name: type
    description: Hardware type identifier, e.g., 4, 5, 6.
    data_type: UInt64
    tests:
    - not_null
    - unique
  - name: cpu
    description: CPU model, e.g., Intel i5-1135G7.
    data_type: String
    tests:
    - not_null
  - name: cores_threads
    description: Cores and threads, e.g., 4/8, 6/12, 32/64.
    data_type: String
    tests:
    - not_null
  - name: psu
    description: Power supply wattage, e.g., 65 Watt, 650 Watt.
    data_type: String
    tests:
    - not_null
  - name: case
    description: Case type, e.g., Integrated, Custom.
    data_type: String
    tests:
    - not_null
  - name: gpu
    description: GPU model, e.g., Onboard, AM 6970.
    data_type: String
    tests:
    - not_null
  config:
    access: public
    materialized: view
    tags:
    - hardware
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: esg_idle_electric_power
  description: Model representing average idle electric power metrics categorized by type.
  columns:
  - name: type
    description: Power type categories (e.g., 4, 5, 6)
    data_type: UInt64
    tests:
    - not_null
  - name: mean
    description: Average idle electric power in units consistent with source (e.g., kWh)
    data_type: Float64
    tests:
    - not_null
  config:
    access: public
    materialized: view
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: esg_node_distribution
  description: Provides the distribution of node types with their associated proportions.
  columns:
  - name: type
    description: Node type identifier (e.g., 4, 5, 6)
    data_type: UInt64
    tests:
    - not_null
    - unique
  - name: distribution
    description: Proportion of nodes for each type (values between 0 and 1)
    data_type: Float64
    tests:
    - not_null
  config:
    access: public
    materialized: view
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_country_power_consumption
  description: Business-facing model aggregating power consumption data by country and client, based on multiple source tables and calculations.
  columns:
  - name: date
    description: The date of the power consumption record.
    data_type: DateTime
  - name: country
    description: The country code or name associated with the record.
    data_type: String
  - name: client
    description: The client identifier, e.g., consensus or execution client.
    data_type: String
  - name: type
    description: The type of power measurement or power source.
    data_type: String
  - name: mean
    description: The average power consumption value in wei.
    data_type: UInt64
  config:
    access: public
    materialized: table
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_carbon_intensity_ensemble
  description: Business-facing model providing monthly carbon intensity estimates with uncertainty modeling, seasonal adjustments, and confidence intervals for global regions.
  columns:
  - name: country_code
    description: Country ISO 3 code or 'WORLD' for aggregate global data.
    data_type: String
  - name: month_date
    description: Date representing the first day of the month in UTC.
    data_type: DateTime
  - name: continent
    description: Continent name associated with the region.
    data_type: String
  - name: base_confidence
    description: Confidence score of the base data (0 to 1).
    data_type: Float64
  - name: source
    description: Data source identifier, e.g., 'ember'.
    data_type: String
  - name: carbon_intensity_mean
    description: Estimated average carbon intensity in gCO2/kWh, seasonal adjusted.
    data_type: Float64
  - name: carbon_intensity_std
    description: Standard deviation representing combined temporal and measurement uncertainty.
    data_type: Float64
  - name: ci_lower_95
    description: Lower bound of the 95% confidence interval.
    data_type: Float64
  - name: ci_upper_95
    description: Upper bound of the 95% confidence interval.
    data_type: Float64
  - name: ci_lower_90
    description: Lower bound of the 90% confidence interval.
    data_type: Float64
  - name: ci_upper_90
    description: Upper bound of the 90% confidence interval.
    data_type: Float64
  - name: coefficient_of_variation
    description: Ratio of the combined standard deviation to the mean, indicating relative uncertainty.
    data_type: Float64
  - name: uncertainty_category
    description: Qualitative assessment of uncertainty ('Low', 'Medium', 'High').
    data_type: String
  - name: base_carbon_intensity
    description: Raw base estimate of carbon intensity in gCO2/kWh.
    data_type: Float64
  - name: temporal_std
    description: Standard deviation due to temporal variability.
    data_type: Float64
  - name: measurement_std
    description: Standard deviation due to measurement uncertainty.
    data_type: Float64
  - name: seasonal_adjustment
    description: Seasonal adjustment factor applied to the base estimate.
    data_type: Float64
  - name: sources_used
    description: Array of sources contributing to the data.
    data_type: String
  - name: confidence_score
    description: Confidence score assigned to the data (0 to 1).
    data_type: Float64
  - name: n_sources
    description: Number of sources used.
    data_type: UInt64
  - name: calculated_at
    description: Timestamp when the data was calculated.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - carbon_intensity
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_dynamic_power_consumption
  description: Business-facing model calculating dynamic power consumption, CO2 emissions, and efficiency metrics for ESG power nodes, incorporating geographic, client, and empirical CCRI data.
  columns:
  - name: country_code
    description: ISO 3-letter country code identifying the node's country.
    data_type: String
  - name: region
    description: Geographic region of the node.
    data_type: String
  - name: sub_region
    description: Sub-region within the main region.
    data_type: String
  - name: nodes_lower_95
    description: Lower bound of 95% confidence interval for total nodes.
    data_type: UInt64
  - name: estimated_total_nodes
    description: Estimated total number of nodes in the category.
    data_type: UInt64
  - name: date
    description: Date of the power consumption measurement.
    data_type: DateTime
  - name: node_category
    description: Category of node hardware tier (e.g., 'home_staker', 'professional_operator', 'cloud_hosted').
    data_type: String
  - name: nodes_upper_95
    description: Upper bound of 95% confidence interval for total nodes.
    data_type: UInt64
  - name: country_code_alpha3
    description: ISO 3-letter country code for traceability.
    data_type: String
  - name: country_name
    description: Name of the country.
    data_type: String
  - name: avg_power_watts_per_node
    description: Calculated average power consumption per node in watts, considering efficiency factors.
    data_type: Float64
  - name: power_std_dev_per_node
    description: Standard deviation of power consumption per node in watts.
    data_type: Float64
  - name: daily_energy_kwh_mean
    description: Estimated daily energy consumption in kilowatt-hours.
    data_type: Float64
  - name: pue_factor
    description: Power Usage Effectiveness factor reflecting datacenter overhead.
    data_type: Float64
  - name: client_efficiency
    description: Multiplier representing client efficiency derived from upstream model.
    data_type: Float64
  - name: diversity_bonus
    description: Resilience bonus factor based on client diversity.
    data_type: Float64
  - name: power_source
    description: Source of CCRI empirical power data.
    data_type: String
  - name: measurement_confidence
    description: Confidence level of CCRI empirical data (0 to 1).
    data_type: Float64
  - name: ccri_base_power_watts
    description: CCRI empirical base power consumption in watts.
    data_type: Float64
  - name: carbon_intensity_gco2_kwh
    description: Estimated grams of CO2 equivalent per kWh, with fallback hierarchy.
    data_type: Float64
  - name: carbon_intensity_std_gco2_kwh
    description: Standard deviation of grams CO2e per kWh.
    data_type: Float64
  - name: carbon_intensity_source
    description: Source attribution for carbon intensity data.
    data_type: String
  - name: daily_co2_kg_mean
    description: Estimated daily CO2 emissions in kilograms.
    data_type: Float64
  - name: daily_co2_kg_std
    description: Standard deviation of daily CO2 emissions in kilograms.
    data_type: Float64
  - name: client_breakdown
    description: JSON string detailing client type breakdowns.
    data_type: String
  - name: total_client_nodes
    description: Total number of client nodes.
    data_type: UInt64
  - name: calculated_at
    description: Timestamp of the calculation execution.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - power_consumption
  meta:
    owner: data-team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_node_classification
  description: This model classifies nodes into categories based on their observed attributes, providing estimated node counts, geographic distribution, and confidence metrics for ESG analysis.
  columns:
  - name: country_code
    description: Country code of the node's geographic location
    data_type: String
  - name: observation_date
    description: Date of the observation in YYYY-MM-DD format
    data_type: DateTime64(0, 'UTC')
  - name: generic_provider
    description: Provider type of the node, e.g., 'AWS', 'DigitalOcean'
    data_type: String
  - name: last_seen_that_day
    description: Timestamp of the last observation on that day
    data_type: DateTime64(0, 'UTC')
  - name: client_type
    description: Client type associated with the node
    data_type: String
  - name: peer_id
    description: Unique identifier for the peer node
    data_type: String
  - name: ip_address
    description: The IP address of the node
    data_type: String
  - name: peer_org
    description: Organization associated with the peer
    data_type: String
  - name: node_category
    description: Classified category of the node, e.g., 'cloud_hosted', 'professional_operator'
    data_type: String
  - name: classification_confidence
    description: Confidence score of the classification (0 to 1)
    data_type: Float64
  - name: date
    description: Date corresponding to the distribution data
    data_type: DateTime64(0, 'UTC')
  - name: observed_nodes
    description: Count of observed nodes for the category on the date
    data_type: UInt64
  - name: estimated_total_nodes
    description: Estimated total number of nodes in the category after scaling
    data_type: UInt64
  - name: nodes_lower_95
    description: Lower bound estimate of total nodes at 95% confidence
    data_type: UInt64
  - name: nodes_upper_95
    description: Upper bound estimate of total nodes at 95% confidence
    data_type: UInt64
  - name: avg_confidence
    description: Average classification confidence score for the category
    data_type: Float64
  - name: sample_coverage
    description: Estimated sample coverage (proportion of total nodes observed)
    data_type: Float64
  - name: scaling_factor
    description: Scaling factor applied to observed nodes based on reachability data
    data_type: Float64
  - name: category_percentage
    description: Percentage share of the category within total estimated nodes per day
    data_type: Float64
  - name: hidden_nodes_estimated
    description: Estimated number of hidden nodes not directly observed
    data_type: UInt64
  - name: hidden_nodes_percentage
    description: Percentage of hidden nodes relative to total estimated nodes
    data_type: Float64
  - name: geographic_distribution
    description: JSON string of country codes and their estimated node counts
    data_type: String
  - name: top_countries
    description: Comma-separated list of top 5 countries by estimated node count
    data_type: String
  - name: calculated_at
    description: Timestamp when the data was calculated
    data_type: DateTime64(0, 'UTC')
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - nodes
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_node_client_distribution
  description: Business-facing model that calculates the distribution of clients across node categories, including estimated client nodes, percentage metrics, and rankings based on the raw SQL logic.
  columns:
  - name: date
    description: The date for which the client distribution metrics are calculated.
    data_type: DateTime
  - name: node_category
    description: Category of the node, e.g., validator, archive, etc.
    data_type: String
  - name: client_type
    description: Type of client, e.g., consensus_Lighthouse, execution_Geth, etc.
    data_type: String
  - name: estimated_client_nodes
    description: Estimated number of client nodes in the category.
    data_type: UInt64
  - name: client_nodes_lower_95
    description: Lower bound estimate (95% confidence interval) for client nodes.
    data_type: UInt64
  - name: client_nodes_upper_95
    description: Upper bound estimate (95% confidence interval) for client nodes.
    data_type: UInt64
  - name: client_efficiency_factor
    description: Efficiency factor of the client relative to baseline (1.0).
    data_type: Float64
  - name: category_client_percentage
    description: Percentage of clients within the node category.
    data_type: Float64
  - name: global_client_percentage
    description: Percentage of clients across all categories.
    data_type: Float64
  - name: rank_in_category
    description: Rank of the client within its node category based on estimated client nodes.
    data_type: UInt64
  - name: global_rank
    description: Rank of the client across all categories based on estimated client nodes.
    data_type: UInt64
  - name: calculated_at
    description: Timestamp when the metrics were calculated.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - nodes
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_node_geographic_distribution
  description: This model provides a detailed distribution of nodes across countries and regions, including estimated counts, confidence bounds, and rankings, for ESG node analysis.
  columns:
  - name: date
    description: The date of the node classification data in UTC.
    data_type: DateTime
  - name: node_category
    description: Category of the node, e.g., validator, full node.
    data_type: String
  - name: country_code
    description: ISO alpha-2 country code representing the country.
    data_type: String
  - name: country_name
    description: The full name of the country.
    data_type: String
  - name: region
    description: The region to which the country belongs.
    data_type: String
  - name: sub_region
    description: The sub-region within the main region.
    data_type: String
  - name: country_code_alpha3
    description: ISO alpha-3 country code.
    data_type: String
  - name: estimated_total_nodes
    description: Estimated total number of nodes in the country.
    data_type: UInt64
  - name: nodes_lower_95
    description: Lower bound of the 95% confidence interval for node count.
    data_type: UInt64
  - name: nodes_upper_95
    description: Upper bound of the 95% confidence interval for node count.
    data_type: UInt64
  - name: category_percentage
    description: Percentage of total nodes within the node category for the country.
    data_type: Float64
  - name: global_percentage
    description: Percentage of total nodes across all countries for the date.
    data_type: Float64
  - name: rank_in_category
    description: Rank of the country within the node category based on estimated nodes.
    data_type: UInt64
  - name: global_rank
    description: Rank of the country globally based on estimated nodes.
    data_type: UInt64
  - name: estimated_nodes
    description: Estimated number of nodes for the country.
    data_type: UInt64
  - name: calculated_at
    description: Timestamp when the data was calculated.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - nodes
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_node_population_chao1
  description: Aggregates peer connection data to estimate network size, success rates, and hidden nodes using Chao-1 and related estimators based on connection attempts and failure analysis.
  columns:
  - name: observation_date
    description: Date of observation, representing the day of peer connection data collection.
    data_type: DateTime
  - name: observed_successful_nodes
    description: Count of peers with successful connections observed in the period.
    data_type: UInt64
  - name: observed_total_peers
    description: Total number of peers observed, including successful and failed.
    data_type: UInt64
  - name: failed_only_peers
    description: Number of peers with only failed connection attempts.
    data_type: UInt64
  - name: chao1_successful_only
    description: Estimated total number of successful peers using Chao-1 estimator.
    data_type: UInt64
  - name: enhanced_total_reachable
    description: Estimated total reachable peers combining multiple signals.
    data_type: UInt64
  - name: estimated_network_size
    description: Total estimated network size including unreachable nodes.
    data_type: UInt64
  - name: estimated_additional_reachable
    description: Additional reachable nodes estimated from failure analysis.
    data_type: UInt64
  - name: connection_success_rate_pct
    description: Percentage of successful connections among total observed peers.
    data_type: Float64
  - name: network_discovery_coverage_pct
    description: Percentage of network discovered relative to total attempts.
    data_type: Float64
  - name: reachable_discovery_coverage_pct
    description: Percentage of reachable nodes discovered relative to total estimated.
    data_type: Float64
  - name: hidden_successful_nodes
    description: Estimated number of successful nodes not observed directly.
    data_type: UInt64
  - name: hidden_reachable_nodes
    description: Estimated number of reachable nodes not observed directly.
    data_type: UInt64
  - name: hidden_total_nodes
    description: Estimated total number of nodes (reachable and unreachable).
    data_type: UInt64
  - name: hidden_successful_pct
    description: Percentage of hidden successful nodes relative to total estimated.
    data_type: Float64
  - name: hidden_total_pct
    description: Percentage of total hidden nodes relative to total network size.
    data_type: Float64
  - name: f1_successful
    description: Count of singleton successful peers (observed once).
    data_type: UInt64
  - name: f2_successful
    description: Count of doubleton successful peers (observed twice).
    data_type: UInt64
  - name: f1_all
    description: Count of singleton peers across all attempts.
    data_type: UInt64
  - name: f2_all
    description: Count of doubleton peers across all attempts.
    data_type: UInt64
  - name: calculated_at
    description: Timestamp when the estimation was calculated.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - nodes
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
