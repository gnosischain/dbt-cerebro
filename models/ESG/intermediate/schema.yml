version: 2
models:

- name: esg_consensus_power
  description: Provides consensus power data with client types and mean values for analysis.
  columns:
  - name: type
    description: The type of power consensus, e.g., 4, 5, 6.
    data_type: UInt64
    tests:
    - not_null
  - name: client
    description: The client name, e.g., Lighthouse, Teku, Lodestar, Nimbus, Prysm.
    data_type: String
    tests:
    - not_null
  - name: mean
    description: The mean value of power consensus in floating point units.
    data_type: Float64
    tests:
    - not_null
  config:
    access: public
    materialized: view
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: esg_country_power_consumption
  description: Aggregated power consumption data by country, combining consensus and execution power metrics along with client-specific estimates.
  columns:
  - name: date
    description: Date of the power consumption record
    data_type: DateTime
    tests:
    - not_null
  - name: country
    description: Country code or name
    data_type: String
    tests:
    - not_null
  - name: power
    description: Estimated power consumption in units consistent with source data
    data_type: Float64
  - name: mean
    description: Calculated mean power value based on client and configuration data
    data_type: Float64
  - name: client
    description: Client identifier associated with power metrics
    data_type: String
  - name: type
    description: Power type category (e.g., consensus, execution, idle)
    data_type: String
  config:
    materialized: table
    access: public
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: esg_execution_power
  description: A model representing execution power metrics categorized by type and client, with mean values.
  columns:
  - name: type
    description: The type of execution, represented as an integer.
    data_type: UInt64
    tests:
    - not_null
  - name: client
    description: The client name, such as 'Erigon' or 'Nethermind'.
    data_type: String
    tests:
    - not_null
  - name: mean
    description: The average execution power value, in floating point units.
    data_type: Float64
    tests:
    - not_null
  config:
    access: public
    materialized: view
    tags:
    - metrics
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: esg_hardware_config
  description: Hardware configuration details including type, CPU, cores/threads, architecture, RAM, storage, GPU, PSU, case, and OS.
  columns:
  - name: architecture
    description: CPU architecture type, e.g., x86/x64.
    data_type: String
    tests:
    - not_null
  - name: os
    description: Operating system installed, e.g., Ubuntu 20.04.
    data_type: String
    tests:
    - not_null
  - name: ram
    description: RAM size in GB, e.g., 16 GB, 64 GB, 256 GB.
    data_type: String
    tests:
    - not_null
  - name: storage
    description: Storage capacity, e.g., 2 TB SSD.
    data_type: String
    tests:
    - not_null
  - name: type
    description: Hardware type identifier, e.g., 4, 5, 6.
    data_type: UInt64
    tests:
    - not_null
    - unique
  - name: cpu
    description: CPU model, e.g., Intel i5-1135G7.
    data_type: String
    tests:
    - not_null
  - name: cores_threads
    description: Cores and threads, e.g., 4/8, 6/12, 32/64.
    data_type: String
    tests:
    - not_null
  - name: psu
    description: Power supply wattage, e.g., 65 Watt, 650 Watt.
    data_type: String
    tests:
    - not_null
  - name: case
    description: Case type, e.g., Integrated, Custom.
    data_type: String
    tests:
    - not_null
  - name: gpu
    description: GPU model, e.g., Onboard, AM 6970.
    data_type: String
    tests:
    - not_null
  config:
    access: public
    materialized: view
    tags:
    - hardware
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: esg_idle_electric_power
  description: Model representing average idle electric power metrics categorized by type.
  columns:
  - name: type
    description: Power type categories (e.g., 4, 5, 6)
    data_type: UInt64
    tests:
    - not_null
  - name: mean
    description: Average idle electric power in units consistent with source (e.g., kWh)
    data_type: Float64
    tests:
    - not_null
  config:
    access: public
    materialized: view
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: esg_node_distribution
  description: Provides the distribution of node types with their associated proportions.
  columns:
  - name: type
    description: Node type identifier (e.g., 4, 5, 6)
    data_type: UInt64
    tests:
    - not_null
    - unique
  - name: distribution
    description: Proportion of nodes for each type (values between 0 and 1)
    data_type: Float64
    tests:
    - not_null
  config:
    access: public
    materialized: view
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_country_power_consumption
  description: Business-facing model aggregating power consumption data by country and client, based on multiple source tables and calculations.
  columns:
  - name: date
    description: The date of the power consumption record.
    data_type: DateTime
  - name: country
    description: The country code or name associated with the record.
    data_type: String
  - name: client
    description: The client identifier, e.g., consensus or execution client.
    data_type: String
  - name: type
    description: The type of power measurement or power source.
    data_type: String
  - name: mean
    description: The average power consumption value in wei.
    data_type: UInt64
  config:
    access: public
    materialized: table
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_carbon_intensity_ensemble
  description: An ensemble model providing monthly estimates of carbon intensity with uncertainty intervals, adjusted for seasonal and regional factors, including confidence metrics and provenance.
  columns:
  - name: country_code
    description: ISO 3 country code or 'WORLD' for global aggregate
    data_type: String
  - name: continent
    description: Continent name for regional adjustment
    data_type: String
  - name: month_date
    description: Date representing the first day of the month (UTC)
    data_type: DateTime
  - name: source
    description: Data source identifier, e.g., 'ember'
    data_type: String
  - name: base_confidence
    description: Confidence score assigned to the data source (0 to 1)
    data_type: Float64
  - name: carbon_intensity_gco2_kwh
    description: Raw carbon intensity value in grams CO2 per kWh
    data_type: Float64
  - name: base_ci
    description: Base carbon intensity estimate before seasonal adjustment
    data_type: Float64
  - name: temporal_uncertainty
    description: Estimated temporal uncertainty based on grid variability
    data_type: Float64
  - name: measurement_uncertainty
    description: Uncertainty due to measurement and averaging effects
    data_type: Float64
  - name: seasonal_factor
    description: Seasonal adjustment factor based on region and month
    data_type: Float64
  - name: carbon_intensity_mean
    description: Adjusted mean carbon intensity estimate
    data_type: Float64
  - name: carbon_intensity_std
    description: Combined standard deviation of the estimate
    data_type: Float64
  - name: ci_lower_95
    description: Lower bound of 95% confidence interval
    data_type: Float64
  - name: ci_upper_95
    description: Upper bound of 95% confidence interval
    data_type: Float64
  - name: ci_lower_90
    description: Lower bound of 90% confidence interval
    data_type: Float64
  - name: ci_upper_90
    description: Upper bound of 90% confidence interval
    data_type: Float64
  - name: coefficient_of_variation
    description: Ratio of standard deviation to mean, indicating relative uncertainty
    data_type: Float64
  - name: uncertainty_category
    description: Qualitative category of uncertainty ('Low', 'Medium', 'High')
    data_type: String
  - name: base_carbon_intensity
    description: Raw base carbon intensity value
    data_type: Float64
  - name: temporal_std
    description: Standard deviation of temporal uncertainty
    data_type: Float64
  - name: measurement_std
    description: Standard deviation of measurement uncertainty
    data_type: Float64
  - name: seasonal_adjustment
    description: Seasonal adjustment factor applied to base estimates
    data_type: Float64
  - name: sources_used
    description: List of data sources contributing to the estimate
    data_type: JSON
  - name: confidence_score
    description: Overall confidence score for the estimate
    data_type: Float64
  - name: n_sources
    description: Number of data sources used
    data_type: Integer
  - name: calculated_at
    description: Timestamp when the estimate was generated
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - carbon_intensity
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_dynamic_power_consumption
  description: Business-facing model estimating power consumption and carbon emissions for ESG nodes, incorporating efficiency, regional, and empirical CCRI data.
  columns:
  - name: nodes_lower_95
    description: Lower bound of estimated total nodes at 95% confidence
    data_type: UInt64
  - name: estimated_total_nodes
    description: Estimated total number of nodes
    data_type: UInt64
  - name: country_code
    description: ISO country code
    data_type: String
  - name: node_category
    description: Category of node (e.g., home_staker, professional_operator, cloud_hosted)
    data_type: String
  - name: region
    description: Geographical region of the node
    data_type: String
  - name: nodes_upper_95
    description: Upper bound of estimated total nodes at 95% confidence
    data_type: UInt64
  - name: country_code_alpha3
    description: Alpha-3 country code for regional identification
    data_type: String
  - name: country_name
    description: Name of the country
    data_type: String
  - name: sub_region
    description: Sub-region within the country
    data_type: String
  - name: date
    description: Date of the measurement or estimate
    data_type: DateTime
  - name: avg_power_watts_per_node
    description: Average power consumption per node in Watts
    data_type: Float64
  - name: power_std_dev_per_node
    description: Standard deviation of power consumption per node in Watts
    data_type: Float64
  - name: daily_energy_kwh_mean
    description: Estimated daily energy consumption in kilowatt-hours
    data_type: Float64
  - name: pue_factor
    description: Power Usage Effectiveness multiplier
    data_type: Float64
  - name: client_efficiency
    description: Multiplier representing client efficiency
    data_type: Float64
  - name: diversity_bonus
    description: Resilience bonus based on client diversity
    data_type: Float64
  - name: power_source
    description: Source of CCRI empirical power data
    data_type: String
  - name: measurement_confidence
    description: Confidence level of CCRI empirical data
    data_type: Float64
  - name: ccri_base_power_watts
    description: CCRI empirical base power in Watts
    data_type: Float64
  - name: carbon_intensity_gco2_kwh
    description: Carbon intensity in gCO2/kWh with fallback hierarchy
    data_type: Float64
  - name: carbon_intensity_std_gco2_kwh
    description: Standard deviation of carbon intensity with fallback hierarchy
    data_type: Float64
  - name: carbon_intensity_source
    description: Source of carbon intensity data
    data_type: String
  - name: daily_co2_kg_mean
    description: Estimated daily CO2 emissions in kilograms
    data_type: Float64
  - name: daily_co2_kg_std
    description: Standard deviation of daily CO2 emissions in kilograms
    data_type: Float64
  - name: client_breakdown
    description: JSON string of client type breakdowns
    data_type: String
  - name: total_client_nodes
    description: Total number of client nodes
    data_type: UInt64
  - name: calculated_at
    description: Timestamp when the calculation was performed
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - power_consumption
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_node_classification
  description: This model classifies nodes into categories based on their observed characteristics, providing estimated node counts, geographic distribution, and confidence metrics for ESG analysis.
  columns:
  - name: date
    description: Observation date of the node data in YYYY-MM-DD format.
    data_type: DateTime
  - name: node_category
    description: Category assigned to the node based on provider and org attributes.
    data_type: String
  - name: observed_nodes
    description: Count of distinct nodes observed on the date.
    data_type: UInt64
  - name: estimated_total_nodes
    description: Estimated total number of nodes in the category, adjusted for sampling.
    data_type: UInt64
  - name: nodes_lower_95
    description: Lower bound estimate of total nodes at 95% confidence.
    data_type: UInt64
  - name: nodes_upper_95
    description: Upper bound estimate of total nodes at 95% confidence.
    data_type: UInt64
  - name: avg_confidence
    description: Average confidence score of classification for the nodes.
    data_type: Float64
  - name: sample_coverage
    description: Proportion of nodes covered in the sample, scaled between 0 and 1.
    data_type: Float64
  - name: scaling_factor
    description: Factor used to scale geographic distribution estimates.
    data_type: Float64
  - name: category_percentage
    description: Percentage share of the category within total estimated nodes for the date.
    data_type: Float64
  - name: hidden_nodes_estimated
    description: Estimated number of hidden nodes not directly observed.
    data_type: UInt64
  - name: hidden_nodes_percentage
    description: Percentage of hidden nodes relative to total estimated nodes.
    data_type: Float64
  - name: geographic_distribution
    description: JSON array of tuples with country code and estimated nodes.
    data_type: String
  - name: top_countries
    description: String listing top 5 countries by estimated nodes, separated by commas.
    data_type: String
  - name: calculated_at
    description: Timestamp when the model was last calculated.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - nodes
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_node_client_distribution
  description: Business-facing model that calculates the distribution of clients across node categories, including estimated counts, percentages, and rankings based on raw classification and client data.
  columns:
  - name: date
    description: The date of the data snapshot, in YYYY-MM-DD format.
    data_type: DateTime
  - name: node_category
    description: The category of the node, such as validator or archive.
    data_type: String
  - name: client_type
    description: The type of client, e.g., consensus or execution, with specific client names.
    data_type: String
  - name: estimated_client_nodes
    description: Estimated number of client nodes in the category.
    data_type: UInt64
  - name: client_nodes_lower_95
    description: Lower bound estimate (95% confidence) of client nodes.
    data_type: UInt64
  - name: client_nodes_upper_95
    description: Upper bound estimate (95% confidence) of client nodes.
    data_type: UInt64
  - name: client_efficiency_factor
    description: Efficiency factor of the client relative to baseline, based on client type.
    data_type: Float64
  - name: category_client_percentage
    description: Percentage of clients within the node category.
    data_type: Float64
  - name: global_client_percentage
    description: Percentage of clients across all categories for the date.
    data_type: Float64
  - name: rank_in_category
    description: Rank of the client within its node category based on estimated count.
    data_type: UInt64
  - name: global_rank
    description: Rank of the client across all categories based on estimated count.
    data_type: UInt64
  - name: calculated_at
    description: Timestamp when the calculation was performed.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - nodes
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_node_geographic_distribution
  description: This model provides a detailed distribution of nodes across countries and categories, including estimates, confidence bounds, and regional metadata, to support geographic and ESG analysis.
  columns:
  - name: date
    description: The date of the classification data, in YYYY-MM-DD format.
    data_type: DateTime
  - name: node_category
    description: The category of nodes, representing different classifications or types.
    data_type: String
  - name: country_code
    description: The ISO alpha-2 country code representing the country.
    data_type: String
  - name: country_name
    description: The full name of the country.
    data_type: String
  - name: region
    description: The region classification of the country.
    data_type: String
  - name: sub_region
    description: The sub-region classification of the country.
    data_type: String
  - name: country_code_alpha3
    description: The ISO alpha-3 country code.
    data_type: String
  - name: estimated_total_nodes
    description: The estimated total number of nodes for the category on the given date.
    data_type: UInt64
  - name: nodes_lower_95
    description: The lower bound of the 95% confidence interval for estimated nodes.
    data_type: UInt64
  - name: nodes_upper_95
    description: The upper bound of the 95% confidence interval for estimated nodes.
    data_type: UInt64
  - name: category_percentage
    description: The percentage of nodes within the category relative to the total estimated nodes.
    data_type: Float64
  - name: global_percentage
    description: The percentage of nodes relative to the total across all categories on the date.
    data_type: Float64
  - name: rank_in_category
    description: The ranking of the country within its category based on estimated nodes.
    data_type: UInt64
  - name: global_rank
    description: The ranking of the country globally based on estimated nodes.
    data_type: UInt64
  - name: calculated_at
    description: Timestamp when the data was calculated.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - nodes
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
- name: int_esg_node_population_chao1
  description: Model estimating network size and node population metrics using Chao1 method based on peer connection analysis, including successful, failed, and all connection attempts with various statistical adjustments.
  columns:
  - name: observation_date
    description: Date of the peer connection observation, in UTC
    data_type: DateTime
  - name: observed_successful_nodes
    description: Count of successfully observed peers on the observation date
    data_type: UInt64
  - name: observed_total_peers
    description: Total number of peers observed, including successful and failed
    data_type: UInt64
  - name: failed_only_peers
    description: Count of peers with only failed connection attempts
    data_type: UInt64
  - name: chao1_successful_only
    description: Estimated total number of successful nodes using Chao1 estimator
    data_type: UInt64
  - name: enhanced_total_reachable
    description: Estimated total reachable nodes, combining multiple signals
    data_type: UInt64
  - name: estimated_network_size
    description: Total estimated network size including unreachable nodes
    data_type: UInt64
  - name: estimated_additional_reachable
    description: Additional reachable nodes estimated from failure analysis
    data_type: UInt64
  - name: connection_success_rate_pct
    description: Percentage of successful connections among total peers
    data_type: Float64
  - name: network_discovery_coverage_pct
    description: Percentage of network discovered relative to total attempts
    data_type: Float64
  - name: reachable_discovery_coverage_pct
    description: Percentage of successfully discovered nodes relative to estimated total
    data_type: Float64
  - name: hidden_successful_nodes
    description: Estimated number of successful nodes not observed directly
    data_type: UInt64
  - name: hidden_reachable_nodes
    description: Estimated number of reachable nodes not observed directly
    data_type: UInt64
  - name: hidden_total_nodes
    description: Estimated total nodes (reachable + unreachable) not observed directly
    data_type: UInt64
  - name: hidden_successful_pct
    description: Percentage of hidden successful nodes relative to estimated total
    data_type: Float64
  - name: hidden_total_pct
    description: Percentage of total hidden nodes relative to estimated network size
    data_type: Float64
  - name: successful_singletons
    description: Count of successful nodes observed only once
    data_type: UInt64
  - name: successful_doubletons
    description: Count of successful nodes observed exactly twice
    data_type: UInt64
  - name: all_singletons
    description: Count of all nodes observed only once (successful or failed)
    data_type: UInt64
  - name: all_doubletons
    description: Count of all nodes observed exactly twice (successful or failed)
    data_type: UInt64
  - name: calculated_at
    description: Timestamp when the estimate was calculated
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - nodes
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: schema-writer
