version: 2
models:

- name: int_esg_carbon_intensity_ensemble
  description: The `int_esg_carbon_intensity_ensemble` model aggregates and enhances uncertainty estimates for country-level electricity carbon intensity data, supporting ESG and sustainability analysis.
  columns:

  - name: month_date
    description: The date representing the month for which the carbon intensity data is recorded.
    data_type: Date

  - name: country_code
    description: The ISO 3-letter country code or 'WORLD' for global data, identifying the country or region.
    data_type: String

  - name: carbon_intensity_gco2_kwh
    description: The measured carbon intensity in grams of CO2 equivalent per kilowatt-hour.
    data_type: Float64

  - name: continent
    description: The continent to which the country belongs, used for seasonal adjustment factors.
    data_type: String

  - name: source
    description: The data source identifier, here indicating Ember electricity data.
    data_type: String

  - name: base_confidence
    description: A fixed confidence level (0.85) indicating the reliability of the data source.
    data_type: Float64

  - name: carbon_intensity_mean
    description: Estimated average carbon intensity in gCO2/kWh, seasonal adjusted.
    data_type: Float64

  - name: carbon_intensity_std
    description: Standard deviation representing combined temporal and measurement uncertainty.
    data_type: Float64

  - name: ci_lower_95
    description: Lower bound of the 95% confidence interval.
    data_type: Float64

  - name: ci_upper_95
    description: Upper bound of the 95% confidence interval.
    data_type: Float64

  - name: ci_lower_90
    description: Lower bound of the 90% confidence interval.
    data_type: Float64

  - name: ci_upper_90
    description: Upper bound of the 90% confidence interval.
    data_type: Float64

  - name: coefficient_of_variation
    description: Ratio of the combined standard deviation to the mean, indicating relative uncertainty.
    data_type: Float64

  - name: uncertainty_category
    description: Qualitative assessment of uncertainty ('Low', 'Medium', 'High').
    data_type: String

  - name: base_carbon_intensity
    description: Raw base estimate of carbon intensity in gCO2/kWh.
    data_type: Float64

  - name: temporal_std
    description: Standard deviation due to temporal variability.
    data_type: Float64

  - name: measurement_std
    description: Standard deviation due to measurement uncertainty.
    data_type: Float64

  - name: seasonal_adjustment
    description: Seasonal adjustment factor applied to the base estimate.
    data_type: Float64

  - name: sources_used
    description: Array of sources contributing to the data.
    data_type: String

  - name: confidence_score
    description: Confidence score assigned to the data (0 to 1).
    data_type: Float64

  - name: n_sources
    description: Number of sources used.
    data_type: UInt64

  - name: calculated_at
    description: Timestamp when the data was calculated.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - carbon_intensity
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: dbt-schema-gen
    _generated_at: '2025-12-12T23:06:57.847186'
    _generated_fields:
    - description
    - columns.country_code.data_type
    - columns.source.description
    - columns.source.data_type
    - columns.base_confidence.data_type
    - config.tags
    - config.materialized
    - columns.continent.data_type
    - columns.carbon_intensity_gco2_kwh.description
    - columns.carbon_intensity_gco2_kwh.data_type
    - columns.base_confidence.description
    - columns.month_date.description
    - columns.country_code.description
    - columns.month_date.data_type
    - columns.continent.description

- name: int_esg_dynamic_power_consumption
  description: The int_esg_dynamic_power_consumption model calculates estimated power consumption metrics for different node categories across geographic regions, incorporating empirical data, client efficiency, and PUE factors to support ESG and power usage analysis.
  columns:

  - name: date
    description: The date for which the power consumption data is recorded, representing the month of analysis.
    data_type: Date
    tests:
    - not_null

  - name: node_category
    description: The classification of nodes based on hardware or operational type, such as 'home_staker', 'professional_operator', or 'cloud_hosted'.
    data_type: String

  - name: country_code
    description: The ISO 3166-1 alpha-2 country code representing the country where the nodes are located.
    data_type: String

  - name: country_name
    description: The full name of the country corresponding to the country code.
    data_type: String

  - name: region
    description: The larger geographic region encompassing the country, used for regional analysis.
    data_type: String

  - name: sub_region
    description: A more specific geographic subdivision within the region for detailed analysis.
    data_type: String

  - name: country_code_alpha3
    description: The ISO 3166-1 alpha-3 country code for standardized country identification.
    data_type: String

  - name: estimated_total_nodes
    description: The estimated total number of nodes in the specified category and region, used for aggregate calculations.
    data_type: UInt64

  - name: nodes_lower_95
    description: The lower bound of the 95% confidence interval for the estimated total nodes, indicating potential minimum nodes.
    data_type: UInt64

  - name: nodes_upper_95
    description: The upper bound of the 95% confidence interval for the estimated total nodes, indicating potential maximum nodes.
    data_type: UInt64

  - name: avg_power_watts_per_node
    description: Calculated average power consumption per node in watts, considering efficiency factors.
    data_type: Float64

  - name: power_std_dev_per_node
    description: Standard deviation of power consumption per node in watts.
    data_type: Float64

  - name: daily_energy_kwh_mean
    description: Estimated daily energy consumption in kilowatt-hours.
    data_type: Float64

  - name: pue_factor
    description: Power Usage Effectiveness factor reflecting datacenter overhead.
    data_type: Float64

  - name: client_efficiency
    description: Multiplier representing client efficiency derived from upstream model.
    data_type: Float64

  - name: diversity_bonus
    description: Resilience bonus factor based on client diversity.
    data_type: Float64

  - name: power_source
    description: Source of CCRI empirical power data.
    data_type: String

  - name: measurement_confidence
    description: Confidence level of CCRI empirical data (0 to 1).
    data_type: Float64

  - name: ccri_base_power_watts
    description: CCRI empirical base power consumption in watts.
    data_type: Float64

  - name: carbon_intensity_gco2_kwh
    description: Estimated grams of CO2 equivalent per kWh, with fallback hierarchy.
    data_type: Float64

  - name: carbon_intensity_std_gco2_kwh
    description: Standard deviation of grams CO2e per kWh.
    data_type: Float64

  - name: carbon_intensity_source
    description: Source attribution for carbon intensity data.
    data_type: String

  - name: daily_co2_kg_mean
    description: Estimated daily CO2 emissions in kilograms.
    data_type: Float64

  - name: daily_co2_kg_std
    description: Standard deviation of daily CO2 emissions in kilograms.
    data_type: Float64

  - name: client_breakdown
    description: JSON string detailing client type breakdowns.
    data_type: String

  - name: total_client_nodes
    description: Total number of client nodes.
    data_type: UInt64

  - name: calculated_at
    description: Timestamp of the calculation execution.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - power_consumption
  meta:
    owner: data-team
    authoritative: false
    generated_by: dbt-schema-gen
    _generated_at: '2025-12-12T23:06:57.847374'
    _generated_fields:
    - columns.date.description
    - config.tags
    - columns.country_name.description
    - columns.country_code.description
    - columns.nodes_upper_95.data_type
    - description
    - columns.estimated_total_nodes.description
    - columns.node_category.description
    - columns.sub_region.data_type
    - columns.region.description
    - columns.date.data_type
    - columns.country_code_alpha3.data_type
    - columns.country_code.data_type
    - columns.nodes_lower_95.description
    - columns.country_name.data_type
    - columns.nodes_lower_95.data_type
    - columns.country_code_alpha3.description
    - columns.region.data_type
    - config.materialized
    - columns.sub_region.description
    - columns.nodes_upper_95.description
    - columns.estimated_total_nodes.data_type
    - columns.node_category.data_type

- name: int_esg_node_classification
  description: The `int_esg_node_classification` model aggregates and classifies peer nodes based on their observed attributes and operational archetypes, supporting ESG and network analysis initiatives.
  columns:

  - name: observation_date
    description: The date when the peer node was last observed, formatted as a date.
    data_type: Date

  - name: peer_id
    description: Unique identifier for each peer node observed in the network.
    data_type: UInt64
    tests:
    - unique
    - not_null

  - name: ip_address
    description: The IP address associated with the peer node during the last observation.
    data_type: String

  - name: client_type
    description: Type of client used by the peer node, as identified during the last visit.
    data_type: String

  - name: country_code
    description: ISO code representing the country where the peer node was located at last observation.
    data_type: String

  - name: generic_provider
    description: The cloud or network provider associated with the peer node, indicating hosting or transit services.
    data_type: String

  - name: peer_org
    description: Organization name associated with the peer node, used for classification purposes.
    data_type: String

  - name: last_seen_that_day
    description: Timestamp of the most recent visit to the peer node on the observation date.
    data_type: DateTime64(0, 'UTC')

  - name: node_category
    description: Classified category of the node, e.g., 'cloud_hosted', 'professional_operator'
    data_type: String

  - name: classification_confidence
    description: Confidence score of the classification (0 to 1)
    data_type: Float64

  - name: date
    description: Date corresponding to the distribution data
    data_type: DateTime64(0, 'UTC')

  - name: observed_nodes
    description: Count of observed nodes for the category on the date
    data_type: UInt64

  - name: estimated_total_nodes
    description: Estimated total number of nodes in the category after scaling
    data_type: UInt64

  - name: nodes_lower_95
    description: Lower bound estimate of total nodes at 95% confidence
    data_type: UInt64

  - name: nodes_upper_95
    description: Upper bound estimate of total nodes at 95% confidence
    data_type: UInt64

  - name: avg_confidence
    description: Average classification confidence score for the category
    data_type: Float64

  - name: sample_coverage
    description: Estimated sample coverage (proportion of total nodes observed)
    data_type: Float64

  - name: scaling_factor
    description: Scaling factor applied to observed nodes based on reachability data
    data_type: Float64

  - name: category_percentage
    description: Percentage share of the category within total estimated nodes per day
    data_type: Float64

  - name: hidden_nodes_estimated
    description: Estimated number of hidden nodes not directly observed
    data_type: UInt64

  - name: hidden_nodes_percentage
    description: Percentage of hidden nodes relative to total estimated nodes
    data_type: Float64

  - name: geographic_distribution
    description: JSON string of country codes and their estimated node counts
    data_type: String

  - name: top_countries
    description: Comma-separated list of top 5 countries by estimated node count
    data_type: String

  - name: calculated_at
    description: Timestamp when the data was calculated
    data_type: DateTime64(0, 'UTC')
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - nodes
  meta:
    owner: analytics-team
    authoritative: false
    generated_by: dbt-schema-gen
    _generated_at: '2025-12-12T23:06:57.847496'
    _generated_fields:
    - columns.client_type.description
    - columns.peer_org.description
    - columns.observation_date.data_type
    - config.tags
    - columns.peer_id.description
    - columns.country_code.description
    - description
    - columns.ip_address.data_type
    - columns.generic_provider.description
    - columns.generic_provider.data_type
    - columns.country_code.data_type
    - columns.observation_date.description
    - columns.last_seen_that_day.data_type
    - columns.peer_org.data_type
    - columns.client_type.data_type
    - columns.ip_address.description
    - config.materialized
    - columns.peer_id.data_type
    - columns.last_seen_that_day.description

- name: int_esg_node_client_distribution
  description: This model estimates the distribution of client nodes across different node categories by integrating client counts from multiple sources and applying scaling factors, aiding in understanding network composition and client deployment.
  columns:

  - name: date
    description: The date for which the node classification and client distribution data is recorded.
    data_type: Date
    tests:
    - not_null

  - name: node_category
    description: The classification category of nodes, such as consensus or execution types.
    data_type: String

  - name: estimated_total_nodes
    description: The estimated total number of nodes in the category on the given date.
    data_type: UInt64

  - name: nodes_lower_95
    description: The lower bound (95% confidence interval) estimate of total nodes in the category.
    data_type: UInt64

  - name: nodes_upper_95
    description: The upper bound (95% confidence interval) estimate of total nodes in the category.
    data_type: UInt64

  - name: scaling_factor
    description: A factor used to adjust node counts based on external metrics or model calibration.
    data_type: Float64

  - name: client_type
    description: Type of client, e.g., consensus_Lighthouse, execution_Geth, etc.
    data_type: String

  - name: estimated_client_nodes
    description: Estimated number of client nodes in the category.
    data_type: UInt64

  - name: client_nodes_lower_95
    description: Lower bound estimate (95% confidence interval) for client nodes.
    data_type: UInt64

  - name: client_nodes_upper_95
    description: Upper bound estimate (95% confidence interval) for client nodes.
    data_type: UInt64

  - name: client_efficiency_factor
    description: Efficiency factor of the client relative to baseline (1.0).
    data_type: Float64

  - name: category_client_percentage
    description: Percentage of clients within the node category.
    data_type: Float64

  - name: global_client_percentage
    description: Percentage of clients across all categories.
    data_type: Float64

  - name: rank_in_category
    description: Rank of the client within its node category based on estimated client nodes.
    data_type: UInt64

  - name: global_rank
    description: Rank of the client across all categories based on estimated client nodes.
    data_type: UInt64

  - name: calculated_at
    description: Timestamp when the metrics were calculated.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - nodes
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: dbt-schema-gen
    _generated_at: '2025-12-12T23:06:57.847581'
    _generated_fields:
    - description
    - columns.date.description
    - columns.estimated_total_nodes.description
    - config.tags
    - config.materialized
    - columns.nodes_lower_95.description
    - columns.nodes_upper_95.description
    - columns.estimated_total_nodes.data_type
    - columns.scaling_factor.data_type
    - columns.node_category.description
    - columns.scaling_factor.description
    - columns.nodes_lower_95.data_type
    - columns.nodes_upper_95.data_type
    - columns.node_category.data_type
    - columns.date.data_type

- name: int_esg_node_geographic_distribution
  description: This model provides a detailed geographic distribution of nodes within different categories, including estimated counts and regional metadata, to support ESG and network analysis.
  columns:

  - name: date
    description: The date for which the geographic distribution data is applicable, formatted as a date.
    data_type: Date
    tests:
    - not_null

  - name: node_category
    description: The classification category of nodes, indicating different types or segments within the network.
    data_type: String

  - name: estimated_total_nodes
    description: The total number of nodes estimated for the given category and date.
    data_type: UInt64

  - name: nodes_lower_95
    description: The lower bound of the 95% confidence interval for the estimated total nodes.
    data_type: UInt64

  - name: nodes_upper_95
    description: The upper bound of the 95% confidence interval for the estimated total nodes.
    data_type: UInt64

  - name: geographic_distribution
    description: A JSON array detailing the distribution of nodes across countries, with each entry specifying a country code and its estimated node count.
    data_type: String

  - name: country_code
    description: ISO alpha-2 country code representing the country.
    data_type: String

  - name: country_name
    description: The full name of the country.
    data_type: String

  - name: region
    description: The region to which the country belongs.
    data_type: String

  - name: sub_region
    description: The sub-region within the main region.
    data_type: String

  - name: country_code_alpha3
    description: ISO alpha-3 country code.
    data_type: String

  - name: category_percentage
    description: Percentage of total nodes within the node category for the country.
    data_type: Float64

  - name: global_percentage
    description: Percentage of total nodes across all countries for the date.
    data_type: Float64

  - name: rank_in_category
    description: Rank of the country within the node category based on estimated nodes.
    data_type: UInt64

  - name: global_rank
    description: Rank of the country globally based on estimated nodes.
    data_type: UInt64

  - name: estimated_nodes
    description: Estimated number of nodes for the country.
    data_type: UInt64

  - name: calculated_at
    description: Timestamp when the data was calculated.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - nodes
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: dbt-schema-gen
    _generated_at: '2025-12-12T23:06:57.847697'
    _generated_fields:
    - description
    - columns.date.description
    - columns.estimated_total_nodes.description
    - config.tags
    - config.materialized
    - columns.nodes_lower_95.description
    - columns.nodes_upper_95.description
    - columns.geographic_distribution.description
    - columns.estimated_total_nodes.data_type
    - columns.node_category.description
    - columns.geographic_distribution.data_type
    - columns.nodes_lower_95.data_type
    - columns.nodes_upper_95.data_type
    - columns.node_category.data_type
    - columns.date.data_type

- name: int_esg_node_population_chao1
  description: The int_esg_node_population_chao1 model calculates the estimated diversity of peer nodes based on connection attempts, providing insights into node population dynamics and connection reliability over time.
  columns:

  - name: observation_date
    description: The date on which the connection data was observed, representing the month of data aggregation.
    data_type: Date

  - name: peer_id
    description: A unique identifier for each peer node involved in connection attempts.
    data_type: UInt64
    tests:
    - unique
    - not_null

  - name: crawl_id
    description: A unique identifier for each individual connection attempt or crawl session.
    data_type: UInt64
    tests:
    - unique
    - not_null

  - name: connection_status
    description: Indicates whether the connection attempt was successful or failed.
    data_type: String

  - name: failure_type
    description: Categorizes the specific reason for connection failure, such as timeout, refused, unreachable, protocol mismatch, dial error, or other failures.
    data_type: String

  - name: observed_successful_nodes
    description: Count of peers with successful connections observed in the period.
    data_type: UInt64

  - name: observed_total_peers
    description: Total number of peers observed, including successful and failed.
    data_type: UInt64

  - name: failed_only_peers
    description: Number of peers with only failed connection attempts.
    data_type: UInt64

  - name: chao1_successful_only
    description: Estimated total number of successful peers using Chao-1 estimator.
    data_type: UInt64

  - name: enhanced_total_reachable
    description: Estimated total reachable peers combining multiple signals.
    data_type: UInt64

  - name: estimated_network_size
    description: Total estimated network size including unreachable nodes.
    data_type: UInt64

  - name: estimated_additional_reachable
    description: Additional reachable nodes estimated from failure analysis.
    data_type: UInt64

  - name: connection_success_rate_pct
    description: Percentage of successful connections among total observed peers.
    data_type: Float64

  - name: network_discovery_coverage_pct
    description: Percentage of network discovered relative to total attempts.
    data_type: Float64

  - name: reachable_discovery_coverage_pct
    description: Percentage of reachable nodes discovered relative to total estimated.
    data_type: Float64

  - name: hidden_successful_nodes
    description: Estimated number of successful nodes not observed directly.
    data_type: UInt64

  - name: hidden_reachable_nodes
    description: Estimated number of reachable nodes not observed directly.
    data_type: UInt64

  - name: hidden_total_nodes
    description: Estimated total number of nodes (reachable and unreachable).
    data_type: UInt64

  - name: hidden_successful_pct
    description: Percentage of hidden successful nodes relative to total estimated.
    data_type: Float64

  - name: hidden_total_pct
    description: Percentage of total hidden nodes relative to total network size.
    data_type: Float64

  - name: f1_successful
    description: Count of singleton successful peers (observed once).
    data_type: UInt64

  - name: f2_successful
    description: Count of doubleton successful peers (observed twice).
    data_type: UInt64

  - name: f1_all
    description: Count of singleton peers across all attempts.
    data_type: UInt64

  - name: f2_all
    description: Count of doubleton peers across all attempts.
    data_type: UInt64

  - name: calculated_at
    description: Timestamp when the estimation was calculated.
    data_type: DateTime
  config:
    access: public
    materialized: incremental
    tags:
    - production
    - esg
    - nodes
  meta:
    owner: analytics_team
    authoritative: false
    generated_by: dbt-schema-gen
    _generated_at: '2025-12-12T23:06:57.847828'
    _generated_fields:
    - description
    - columns.observation_date.description
    - columns.observation_date.data_type
    - columns.crawl_id.data_type
    - config.tags
    - config.materialized
    - columns.connection_status.description
    - columns.crawl_id.description
    - columns.connection_status.data_type
    - columns.peer_id.data_type
    - columns.failure_type.data_type
    - columns.peer_id.description
    - columns.failure_type.description
